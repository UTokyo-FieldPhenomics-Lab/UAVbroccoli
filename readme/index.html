<!DOCTYPE html><html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes"/>
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="stylesheet" type="text/css" id="themeDefaultStyle" href="stage/build/export/base.css?1.7.5"/>
    <link rel="stylesheet" type="text/css" id="themeStyle" href="appearance/themes/notion-theme/theme.css?1.7.5"/>
    <style>
        body {background-color: var(--b3-theme-background);color: var(--b3-theme-on-background)}
        .b3-typography, .protyle-wysiwyg, .protyle-title {font-size:18px !important}
.b3-typography code:not(.hljs), .protyle-wysiwyg code:not(.hljs) { font-variant-ligatures: none }
.li > .protyle-action {height:37px;line-height: 37px}
.protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h1, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h2, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h3, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h4, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h5, .protyle-wysiwyg [data-node-id].li > .protyle-action ~ .h6 {line-height:37px;}
.protyle-wysiwyg [data-node-id].li > .protyle-action:after {height: 18px;width: 18px;margin:-9px 0 0 -9px}
.protyle-wysiwyg [data-node-id].li > .protyle-action svg {height: 14px}
.protyle-wysiwyg [data-node-id] [spellcheck="false"] {min-height:29px}
.protyle-wysiwyg .li {min-height:37px}
.protyle-gutters button svg {height:29px}
.protyle-wysiwyg img.emoji, .b3-typography img.emoji {width:21px}
.protyle-wysiwyg .h1 img.emoji, .b3-typography h1 img.emoji {width:39px}
.protyle-wysiwyg .h2 img.emoji, .b3-typography h2 img.emoji {width:34px}
.protyle-wysiwyg .h3 img.emoji, .b3-typography h3 img.emoji {width:31px}
.protyle-wysiwyg .h4 img.emoji, .b3-typography h4 img.emoji {width:28px}
.protyle-wysiwyg .h5 img.emoji, .b3-typography h5 img.emoji {width:25px}
.protyle-wysiwyg .h6 img.emoji, .b3-typography h6 img.emoji {width:22px}.b3-typography, .protyle-wysiwyg, .protyle-title, .protyle-title__input{font-family: "Microsoft YaHei UI", "quote", "Helvetica Neue", "Luxi Sans", "DejaVu Sans", "Hiragino Sans GB", "Microsoft Yahei", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Noto Color Emoji", "Segoe UI Symbol", "Android Emoji", "EmojiSymbols" !important;}
    </style>
</head>
<body>
<div class="protyle-wysiwyg protyle-wysiwyg--attr" style="max-width: 800px;margin: 0 auto;" id="preview"><div data-node-id="20220120150300-07a8klt" data-type="NodeParagraph" class="p" id="20220120150300-07a8klt" updated="20220120155715"><div contenteditable="false" spellcheck="false">The <u>Agisoft Metashape</u> is used and recommended for processing data (<u>Pix4D</u> has no batch scripts for plot reconstruction, need to process all flights manually, but also supported for later <strong>root detection</strong> and <strong>head segmentation</strong>).</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120155615-uwbiqp7" data-type="NodeParagraph" class="p" id="20220120155615-uwbiqp7" updated="20220120170231"><div contenteditable="false" spellcheck="false">There are <strong>two different folder</strong> involved in this protocol:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="o" data-node-id="20220120151647-cpzdjk3" data-type="NodeList" class="list" updated="20220120160113" id="20220120151647-cpzdjk3"><div data-marker="1." data-subtype="o" data-node-id="20220120151648-odxwysp" data-type="NodeListItem" class="li" id="20220120151648-odxwysp" updated="20220120160113"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">1.</div><div data-node-id="20220120151648-5guz13x" data-type="NodeParagraph" class="p" id="20220120151648-5guz13x" updated="20220120154617"><div contenteditable="false" spellcheck="false">folder for UAV data &amp; data processing, </div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120154856-1xget80" data-type="NodeList" class="list" id="20220120154856-1xget80" updated="20220120160113"><div data-marker="*" data-subtype="u" data-node-id="20220120154856-6xrmx3m" data-type="NodeListItem" class="li" id="20220120154856-6xrmx3m"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120154609-2omr79s" data-type="NodeParagraph" class="p" id="20220120154609-2omr79s" updated="20220120154808"><div contenteditable="false" spellcheck="false"><code>00_rgb_zip</code> -&gt; all the zipped uav images</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120154856-83t62sq" data-type="NodeListItem" class="li" id="20220120154856-83t62sq"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120154731-13t8efe" data-type="NodeParagraph" class="p" id="20220120154731-13t8efe" updated="20220120154817"><div contenteditable="false" spellcheck="false"><code>00_rgb_raw</code> -&gt; unzipped uav images</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120154856-nobfh7w" data-type="NodeListItem" class="li" id="20220120154856-nobfh7w"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120154733-03qjezv" data-type="NodeParagraph" class="p" id="20220120154733-03qjezv" updated="20220120154839"><div contenteditable="false" spellcheck="false"><code>01_metashape_projects</code> -&gt; metashape project and results</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120154900-86542r5" data-type="NodeList" class="list" id="20220120154900-86542r5"><div data-marker="*" data-subtype="u" data-node-id="20220120154900-2d77fd1" data-type="NodeListItem" class="li" id="20220120154900-2d77fd1"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120154900-7ssc4oz" data-type="NodeParagraph" class="p" id="20220120154900-7ssc4oz" updated="20220120154929"><div contenteditable="false" spellcheck="false"><code>*.psx </code>&amp; <code>*.files</code> -&gt; metashape project files</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120154933-qw5g1hz" data-type="NodeListItem" class="li" id="20220120154933-qw5g1hz"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120154933-tj0fk6u" data-type="NodeParagraph" class="p" id="20220120154933-tj0fk6u" updated="20220120154959"><div contenteditable="false" spellcheck="false"><code>outputs</code> -&gt; DOM DSM maps and Point clouds</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120155000-pjsauts" data-type="NodeListItem" class="li" id="20220120155000-pjsauts"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120155000-mr4kt7g" data-type="NodeParagraph" class="p" id="20220120155000-mr4kt7g" updated="20220120155110"><div contenteditable="false" spellcheck="false"><code>bbox.pkl</code> -&gt; plot bounding box files made by our scripts (will be created automatically later)</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120154856-uqmd71f" data-type="NodeListItem" class="li" id="20220120154856-uqmd71f" updated="20220120155355"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120154735-3jyc1cp" data-type="NodeParagraph" class="p" id="20220120154735-3jyc1cp" updated="20220120155146"><div contenteditable="false" spellcheck="false"><code>02_GIS</code>  -&gt; GIS files</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120155146-jytywxg" data-type="NodeList" class="list" id="20220120155146-jytywxg" updated="20220120155355"><div data-marker="*" data-subtype="u" data-node-id="20220120155146-myrflyx" data-type="NodeListItem" class="li" id="20220120155146-myrflyx" updated="20220120155355"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120155146-t18qwrx" data-type="NodeParagraph" class="p" id="20220120155146-t18qwrx" updated="20220120155249"><div contenteditable="false" spellcheck="false"><code>gcs.csv</code> -&gt; ground control points measured by RTK devices, it also need to make the following coded panel first</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120155250-cp2n4e1" data-type="NodeParagraph" class="p" id="20220120155250-cp2n4e1" updated="20220120155355"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 182px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220115140256-1el73jh.png" data-src="assets/image-20220115140256-1el73jh.png" alt="image.png" title="16bit coded target" style="width: 172px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title">16bit coded target</span></span><span> </span></span><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120155355-33kjop8.png" data-src="assets/image-20220120155355-33kjop8.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120154856-flg2pkm" data-type="NodeListItem" class="li" id="20220120154856-flg2pkm" updated="20220120160047"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120154737-gjl65ih" data-type="NodeParagraph" class="p" updated="20220120160047" id="20220120154737-gjl65ih"><div contenteditable="false" spellcheck="false"><code>10_root_position</code> -&gt; tempoary results for broccoli bud detection by yolo v5</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120154856-uq19crj" data-type="NodeListItem" class="li" id="20220120154856-uq19crj" updated="20220120160113"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120154738-mraw9d4" data-type="NodeParagraph" class="p" id="20220120154738-mraw9d4" updated="20220120160113"><div contenteditable="false" spellcheck="false"><code>11_head_segmentation</code> -&gt; temporay results for broccoli head segmentation by BiSeNet and active learning</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="2." data-subtype="o" data-node-id="20220120151701-ilgothr" data-type="NodeListItem" class="li" id="20220120151701-ilgothr"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">2.</div><div data-node-id="20220120151701-ayq8c32" data-type="NodeParagraph" class="p" updated="20220120151720" id="20220120151701-ayq8c32"><div contenteditable="false" spellcheck="false">folder for scripts to analyze previous data</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120153459-66o520r" data-type="NodeParagraph" class="p" id="20220120153459-66o520r" updated="20220120153506"><div contenteditable="false" spellcheck="false">code download here: <a target="_blank" href="https://github.com/oceam/UAVbroccoli">https://github.com/oceam/UAVbroccoli</a></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120154017-xgxzgyk" data-type="NodeParagraph" class="p" id="20220120154017-xgxzgyk" updated="20220120154436"><div contenteditable="false" spellcheck="false"><code>01_slice</code>, <code>02_raw_clip</code> are <strong>previous version</strong> for <strong>Pix4D</strong> project (2019-2021 summer data) <u>only for inner tests</u>, the files were arranged in a mess, hard to use and will not be maintained anymore (but contains draft of deviation), <strong>please ignore it</strong>.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120154049-5ceyuzf" data-type="NodeParagraph" class="p" id="20220120154049-5ceyuzf" updated="20220120154602"><div contenteditable="false" spellcheck="false"><code>10_agisoft_batch_tools</code>, <code>11_root_pos</code>, and <code>12_head_seg</code>, are complete protocol scripts for <strong>Agisoft metashape</strong> (2021 autumn data)</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120153725-wi6iqy1" data-type="NodeThematicBreak" class="hr" id="20220120153725-wi6iqy1" updated="20220120153725"><div></div></div><div data-node-id="20220120165930-pck37rv" data-type="NodeParagraph" class="p" id="20220120165930-pck37rv" updated="20220120165930"><div contenteditable="false" spellcheck="false">Please also download the following open source free software for later usage</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="o" data-node-id="20220120153742-wraf96h" data-type="NodeList" class="list" id="20220120153742-wraf96h" updated="20220121220837"><div data-marker="1." data-subtype="o" data-node-id="20220120153743-6h8daie" data-type="NodeListItem" class="li" id="20220120153743-6h8daie" updated="20220120154008"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">1.</div><div data-node-id="20220120153743-smwdnv5" data-type="NodeParagraph" class="p" id="20220120153743-smwdnv5" updated="20220120153758"><div contenteditable="false" spellcheck="false">QGIS for checking &amp; editing shapefiles</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120153800-rl448rp" data-type="NodeParagraph" class="p" id="20220120153800-rl448rp" updated="20220120154008"><div contenteditable="false" spellcheck="false"><a target="_blank" href="https://qgis.org/en/site/">https://qgis.org/en/site/</a></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="2." data-subtype="o" data-node-id="20220120153758-4hl6dxr" data-type="NodeListItem" class="li" id="20220120153758-4hl6dxr" updated="20220120153959"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">2.</div><div data-node-id="20220120153758-2e4z0bj" data-type="NodeParagraph" class="p" id="20220120153758-2e4z0bj" updated="20220120153946"><div contenteditable="false" spellcheck="false">Labelme for labeling images for deep learning training</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120153947-i85m7xi" data-type="NodeParagraph" class="p" id="20220120153947-i85m7xi" updated="20220120153959"><div contenteditable="false" spellcheck="false"><a target="_blank" href="https://github.com/wkentaro/labelme/releases/tag/v4.6.0">https://github.com/wkentaro/labelme/releases/tag/v4.6.0</a></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="3." data-subtype="o" data-node-id="20220120162241-400qs7q" data-type="NodeListItem" class="li" updated="20220121220837" id="20220120162241-400qs7q"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">3.</div><div data-node-id="20220120162241-700by1b" data-type="NodeParagraph" class="p" id="20220120162241-700by1b" updated="20220120163646"><div contenteditable="false" spellcheck="false">Miniconda for running the scripts</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120163638-rxxc5jt" data-type="NodeParagraph" class="p" updated="20220120163639" id="20220120163638-rxxc5jt"><div contenteditable="false" spellcheck="false"><a target="_blank" href="https://docs.conda.io/en/latest/miniconda.html">Miniconda — Conda documentation</a></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120163647-2om2iyo" data-type="NodeParagraph" class="p" id="20220120163647-2om2iyo" updated="20220121220835"><div contenteditable="false" spellcheck="false">Create the environment named <code>uavbroccoli</code>(or any other name you like) by the following code (tested on <strong>Pytorch=1.8.2, CUDA=11.1</strong>)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120163718-8m7mnl6" data-type="NodeCodeBlock" class="code-block" id="20220120163718-8m7mnl6" updated="20220120165254"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">bash</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false"># cd to UAVbroccoli Github project
cd path/to/github/UAVbroccoli
conda env create -n uavbroccoli -f conda_requirements.yml
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120164154-unbzj07" data-type="NodeParagraph" class="p" id="20220120164154-unbzj07" updated="20220121220831"><div contenteditable="false" spellcheck="false"><strong>or</strong> you can create by the following steps:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120164204-ytgoxds" data-type="NodeCodeBlock" class="code-block" id="20220120164204-ytgoxds" updated="20220121014139"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">bash</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false"># create environment (only use conda for environment management)
conda env create -n uavbroccoli python==3.8

# install pytorch (by pip)
pip3 install torch==1.8.2+cu111 torchvision==0.9.2+cu111 torchaudio===0.8.2 -f https://download.pytorch.org/whl/lts/1.8/torch_lts.html

# install yolov5 dependcies
pip install -r yolov5/requirements.txt

# install EasyIDP dependices
pip install -r EasyIDP/requirements.txt

# install other packages
pip install imagecodecs scikit-learn
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120165335-9gl5ggl" data-type="NodeParagraph" class="p" id="20220120165335-9gl5ggl" updated="20220121220837"><div contenteditable="false" spellcheck="false">Test whether pytorch is successfully installed:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120165345-3jptsxg" data-type="NodeCodeBlock" class="code-block" id="20220120165345-3jptsxg" updated="20220120165601"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">(uavbroccoli) path/to/github/UAVbroccoli&gt;python
&gt;&gt;&gt; import torch
&gt;&gt;&gt; torch.zeros([1]).cuda()
tensor([0.], device='cuda:0')
&gt;&gt;&gt; torch.version.cuda
'11.1'
&gt;&gt;&gt; torch.backends.cudnn.version()
8005
</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h1" data-node-id="20220120144308-7ghziei" data-type="NodeHeading" class="h1" id="20220120144308-7ghziei" updated="20220120144308"><div contenteditable="false" spellcheck="false">Step 1: Test project</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120144308-b6ichw6" data-type="NodeHeading" class="h2" id="20220120144308-b6ichw6" updated="20220120144308"><div contenteditable="false" spellcheck="false">1.1 test auto load image scripts</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="o" data-node-id="20220120144308-8lscfja" data-type="NodeList" class="list" updated="20220120232516" id="20220120144308-8lscfja"><div data-marker="1." data-subtype="o" data-node-id="20220120144308-fngurqs" data-type="NodeListItem" class="li" id="20220120144308-fngurqs"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">1.</div><div data-node-id="20220120144308-7g646f6" data-type="NodeParagraph" class="p" id="20220120144308-7g646f6"><div contenteditable="false" spellcheck="false">open metashape software</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="2." data-subtype="o" data-node-id="20220120144308-al46jww" data-type="NodeListItem" class="li" id="20220120144308-al46jww" updated="20220120232516"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">2.</div><div data-node-id="20220120144308-pbktlzx" data-type="NodeParagraph" class="p" id="20220120144308-pbktlzx" updated="20220120232516"><div contenteditable="false" spellcheck="false">run <code>10_agisoft_batch_tools/00_create_tested_project.py</code> in metashape, it auto adds metashape flights as chunk (need check file path in codes when deal with new data, and)</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="3." data-subtype="o" data-node-id="20220120144308-jrxagii" data-type="NodeListItem" class="li" id="20220120144308-jrxagii"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">3.</div><div data-node-id="20220120144308-ohv6i8j" data-type="NodeParagraph" class="p" id="20220120144308-ohv6i8j"><div contenteditable="false" spellcheck="false">use detect markers, find which marker type in the image (12bit or 16bit?)</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120144308-e5yad6l" data-type="NodeHeading" class="h2" id="20220120144308-e5yad6l" updated="20220120144308"><div contenteditable="false" spellcheck="false">1.2 Link GCP &amp; markers</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="o" data-node-id="20220120144308-s8ktgzw" data-type="NodeList" class="list" id="20220120144308-s8ktgzw" updated="20220120150218"><div data-marker="1." data-subtype="o" data-node-id="20220120144308-2lhghsh" data-type="NodeListItem" class="li" id="20220120144308-2lhghsh" updated="20220120150138"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">1.</div><div data-node-id="20220120144308-hmessdc" data-type="NodeParagraph" class="p" id="20220120144308-hmessdc" updated="20220120150138"><div contenteditable="false" spellcheck="false">edit <code>02_GIS/gcp.xls</code>, make it to following type as save as csv <code>02_GIS/gcp.csv</code>, the order is <strong>important</strong></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120144308-up7zysu" data-type="NodeTable" class="table" id="20220120144308-up7zysu"><div contenteditable="false" spellcheck="false"><table><thead><tr><th>id</th><th>longitude</th><th>latitude</th><th>altitude</th></tr></thead><tbody><tr><td>...</td><td>...</td><td>...</td><td>...</td></tr></tbody></table></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="2." data-subtype="o" data-node-id="20220120144308-86n78g2" data-type="NodeListItem" class="li" id="20220120144308-86n78g2"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">2.</div><div data-node-id="20220120144308-znrggeh" data-type="NodeParagraph" class="p" id="20220120144308-znrggeh"><div contenteditable="false" spellcheck="false">in metashape, align a tested flight, import <code>02_GIS/gcp.csv</code> as reference</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="3." data-subtype="o" data-node-id="20220120144308-1vdj1io" data-type="NodeListItem" class="li" id="20220120144308-1vdj1io" updated="20220120150218"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">3.</div><div data-node-id="20220120144308-54o70zc" data-type="NodeParagraph" class="p" id="20220120144308-54o70zc"><div contenteditable="false" spellcheck="false">check the imported reference id with target detected id, and modify <code>02_GIS/gcp.csv</code> id column to fit to target detected id<br />for example, in this case:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120144308-0slx6i9" data-type="NodeParagraph" class="p" id="20220120144308-0slx6i9" updated="20220120161947"><div contenteditable="false" spellcheck="false">001-&gt;rm; 002-&gt;34; 003-&gt;5; 004-&gt;1; 005-&gt;36; 006-&gt;33; 007-&gt;41; 008-&gt; 35; 009-&gt;4; 010-&gt;40; 011-&gt;2; 012-&gt;3</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120150217-njtzp2i" data-type="NodeParagraph" class="p" updated="20220120150218" id="20220120150217-njtzp2i"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 465px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220115142856-9soh2ez.png" data-src="assets/image-20220115142856-9soh2ez.png" alt="image.png" title="single number (left) is imported RTK, target x (right) is Agisoft detected" style="width: 455px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title">single number (left) is imported RTK, target x (right) is Agisoft detected</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120150221-m0kdhm0" data-type="NodeParagraph" class="p" id="20220120150221-m0kdhm0" updated="20220120161808"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 738px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120161808-lkoh1sq.png" data-src="assets/image-20220120161808-lkoh1sq.png" alt="image.png" title="Change RTK GPS data (left) to Agisoft usable references (right)" /><span class="protyle-action__drag"></span><span class="protyle-action__title">Change RTK GPS data (left) to Agisoft usable references (right)</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="4." data-subtype="o" data-node-id="20220120144308-o3cdwxw" data-type="NodeListItem" class="li" id="20220120144308-o3cdwxw"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">4.</div><div data-node-id="20220120144308-t8wy9s1" data-type="NodeParagraph" class="p" id="20220120144308-t8wy9s1"><div contenteditable="false" spellcheck="false">Then the tested project can be removed.</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h1" data-node-id="20220120144308-aw6x0rz" data-type="NodeHeading" class="h1" id="20220120144308-aw6x0rz" updated="20220120144308" alias="need to extend more details"><div contenteditable="false" spellcheck="false">Step 2: Make GIS products</div><div class="protyle-attr" contenteditable="false"><div class="protyle-attr--alias"><svg><use xlink:href="#iconA"></use></svg>need to extend more details</div></div></div><div data-subtype="h2" data-node-id="20220120144308-tgpfd10" data-type="NodeHeading" class="h2" id="20220120144308-tgpfd10" updated="20220120144308"><div contenteditable="false" spellcheck="false">2.1 Auto load flight images</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="o" data-node-id="20220120144308-d8jah81" data-type="NodeList" class="list" id="20220120144308-d8jah81" updated="20220120232543"><div data-marker="1." data-subtype="o" data-node-id="20220120144308-3751w7c" data-type="NodeListItem" class="li" id="20220120144308-3751w7c"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">1.</div><div data-node-id="20220120144308-gsjaf02" data-type="NodeParagraph" class="p" id="20220120144308-gsjaf02"><div contenteditable="false" spellcheck="false">open metashape software</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="2." data-subtype="o" data-node-id="20220120144308-aave9z4" data-type="NodeListItem" class="li" updated="20220120232543" id="20220120144308-aave9z4"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">2.</div><div data-node-id="20220120144308-ckl3gjl" data-type="NodeParagraph" class="p" id="20220120144308-ckl3gjl" updated="20220120232543"><div contenteditable="false" spellcheck="false">run <code>10_agisoft_batch_tools/01_add_images_to_projects.py</code>(edit first), this combines import image, detect marker, load marker reference GSP info together<br />remember to delete the default <code>chunk 1</code> as save project</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120144308-a14hb4e" data-type="NodeHeading" class="h2" id="20220120144308-a14hb4e" updated="20220120144308"><div contenteditable="false" spellcheck="false">2.2 Manual check status</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="o" data-node-id="20220120144308-kocjm0b" data-type="NodeList" class="list" id="20220120144308-kocjm0b" updated="20220120232640"><div data-marker="1." data-subtype="o" data-node-id="20220120144308-1qv6zjp" data-type="NodeListItem" class="li" updated="20220120232640" id="20220120144308-1qv6zjp"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">1.</div><div data-node-id="20220120144308-o9hjxxo" data-type="NodeParagraph" class="p" id="20220120144308-o9hjxxo"><div contenteditable="false" spellcheck="false">auto check images, disable some incorrect image (e.g. during flight, multi-spectral board image), and edit <code>reference -&gt; settings -&gt; miscellaneous/caputer distance(m)</code> to flight height</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120232639-aq5n84r" data-type="NodeParagraph" class="p" id="20220120232639-aq5n84r" updated="20220120232640"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 447px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20211028144907-t3jbcg8.png" data-src="assets/image-20211028144907-t3jbcg8.png" alt="image.png" style="width: 437px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120144308-thro926" data-type="NodeHeading" class="h2" id="20220120144308-thro926" updated="20220120144308"><div contenteditable="false" spellcheck="false">2.3 Change plot boundary</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="o" data-node-id="20220120144308-ynvcuha" data-type="NodeList" class="list" updated="20220120232929" id="20220120144308-ynvcuha"><div data-marker="1." data-subtype="o" data-node-id="20220120144308-sww532x" data-type="NodeListItem" class="li" id="20220120144308-sww532x" updated="20220120232702"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">1.</div><div data-node-id="20220120144308-3sdxiib" data-type="NodeParagraph" class="p" id="20220120144308-3sdxiib" updated="20220120232702"><div contenteditable="false" spellcheck="false">in matashape, batch_processing tool, load <code>10_agisoft_batch_tools/02_align_photos_all_chunk.xml</code>, run align all chunks (flights)</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="2." data-subtype="o" data-node-id="20220120144308-vh702o6" data-type="NodeListItem" class="li" id="20220120144308-vh702o6"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">2.</div><div data-node-id="20220120144308-euwvto4" data-type="NodeParagraph" class="p" id="20220120144308-euwvto4"><div contenteditable="false" spellcheck="false">in the first chunk, manual edit bounding box to a proper size (covers the main field and ground control points)</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="3." data-subtype="o" data-node-id="20220120144308-zyg6930" data-type="NodeListItem" class="li" id="20220120144308-zyg6930" updated="20220120232929"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">3.</div><div data-node-id="20220120144308-m9c2ce8" data-type="NodeParagraph" class="p" id="20220120144308-m9c2ce8" updated="20220120232929"><div contenteditable="false" spellcheck="false">edit <code>10_agisoft_batch_tools/03_change_bbox.py</code>, especially the <code>pkl_path</code> and line23-24, make sure is the chunk you edited:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120144308-efg33j2" data-type="NodeCodeBlock" class="code-block" id="20220120144308-efg33j2"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">pkl_path = r&quot;E:\2022_tanashi_broccoli\01_metashape_projects\bbox.pkl&quot;

if os.path.exists(pkl_path):
    ...
else:
    # read chunk 211101
    chunk = doc.chunks[2]   # here is the 3rd chunk, need to change to 0 if necessary
    if chunk.label == &quot;20211101_0&quot;:
        ...
</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="4." data-subtype="o" data-node-id="20220120144308-h0jqc7s" data-type="NodeListItem" class="li" id="20220120144308-h0jqc7s" updated="20220120232733"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">4.</div><div data-node-id="20220120144308-nta7rdd" data-type="NodeParagraph" class="p" id="20220120144308-nta7rdd" updated="20220120232733"><div contenteditable="false" spellcheck="false">run <code>10_agisoft_batch_tools/03_change_bbox.py</code> in metashape, it will change all chunks' bbox to the first chunk</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120144308-pjcbjkf" data-type="NodeHeading" class="h2" id="20220120144308-pjcbjkf" updated="20220120144308"><div contenteditable="false" spellcheck="false">2.4 Batch run all flights</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="o" data-node-id="20220120144308-njpcvg3" data-type="NodeList" class="list" id="20220120144308-njpcvg3" updated="20220120232451"><div data-marker="1." data-subtype="o" data-node-id="20220120144308-3lnmfm4" data-type="NodeListItem" class="li" id="20220120144308-3lnmfm4" updated="20220120232451"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">1.</div><div data-node-id="20220120144308-c8ihgvr" data-type="NodeParagraph" class="p" id="20220120144308-c8ihgvr" updated="20220120232451"><div contenteditable="false" spellcheck="false">in metashape batch_tool, load <code>10_agisoft_batch_tools/04_batch_full_outputs.xml</code>, this will run all the point cloud, orthomasic, dsm, and export to given folder (please edit the xml file before run, or edit directly in the metashape)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120144308-gayrbbd" data-type="NodeCodeBlock" class="code-block" id="20220120144308-gayrbbd"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">xml</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">&lt;job name=&quot;ExportDem&quot; target=&quot;unprocessed&quot;&gt;
    &lt;image_format&gt;2&lt;/image_format&gt;
    &lt;path&gt;{projectfolder}/outputs/broccoli_tanashi_5_{chunklabel}_dsm.tif&lt;/path&gt;
</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h1" data-node-id="20220120144308-snkhh2d" data-type="NodeHeading" class="h1" id="20220120144308-snkhh2d" updated="20220120151600"><div contenteditable="false" spellcheck="false">Step 3: Yolo v5 detect broccoli seedlings</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121215309-6tkvdmi" data-type="NodeParagraph" class="p" id="20220121215309-6tkvdmi" updated="20220121215330"><div contenteditable="false" spellcheck="false">This setups have already been packed into python batch scripts:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121215330-vniml5i" data-type="NodeCodeBlock" class="code-block" id="20220121215330-vniml5i" updated="20220121215545"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">plaintxt</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">.11_root_pos
├── 01_slice_dom.py
├── 02_prepare_yolo_data.py
├── 03_train_yolov5.py
├── 04_apply_yolov5.py
├── 05_yolo2shp.py
├── 06_order_by_ridge.py
└── config.py
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121215424-d1k0ssx" data-type="NodeParagraph" class="p" id="20220121215424-d1k0ssx" updated="20220121215439"><div contenteditable="false" spellcheck="false">The <code>config.py</code> contains almost all the parameters used in the following procedures, only need to modify here, you don't need to edit all of them at the beginning, you can edit this steps by steps with the following protocols.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120170155-27epjv1" data-type="NodeParagraph" class="p" id="20220120170155-27epjv1" updated="20220120170254"><div contenteditable="false" spellcheck="false">Very first, please specify the two folders mentioned above:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120170255-avweav4" data-type="NodeCodeBlock" class="code-block" id="20220120170255-avweav4" updated="20220121215457"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">###########
# 00 init #
###########
easyidp_package_path = &quot;path/to/github/UAVbroccoli/EasyIDP&quot;
project_data_folder = &quot;path/to/your/broccoli_data_folder&quot;
working_spacename = &quot;11_root_position&quot;
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120144308-495h6a2" data-type="NodeHeading" class="h2" id="20220120144308-495h6a2" updated="20220120170025"><div contenteditable="false" spellcheck="false">3.1 Split DOM to small parts</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120170603-1gc6lu1" data-type="NodeParagraph" class="p" id="20220120170603-1gc6lu1" updated="20220120170622"><div contenteditable="false" spellcheck="false">please specify the following paramters in <code>config.py</code></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120170603-5xjuiks" data-type="NodeCodeBlock" class="code-block" id="20220120170603-5xjuiks" updated="20220120173147"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">################
# 01 slice dom #
################
dom_path_for_detection = f&quot;{project_data_folder}/01_metashape_projects/outputs/broccoli_tanashi_5_20211101_0_dom.tif&quot;
dom_slice_save_folder = f&quot;{project_data_folder}/{working_spacename}&quot;
dom_slice_save_format = &quot;jpg&quot;
dom_slice_length = 1300   # must be a square
dom_slice_buffer = 200
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120170603-3msnzdx" data-type="NodeList" class="list" id="20220120170603-3msnzdx" updated="20220120173252"><div data-marker="*" data-subtype="u" data-node-id="20220120170707-zkrqt8u" data-type="NodeListItem" class="li" id="20220120170707-zkrqt8u"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120170707-gdz9pk3" data-type="NodeParagraph" class="p" id="20220120170707-gdz9pk3" updated="20220120171019"><div contenteditable="false" spellcheck="false"><code>dom_path_for_detection</code>: the DOM with broccoli buds, better with clear weather (as few variation as light as possible), recommended using status like the following images:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120170830-khev9v0" data-type="NodeParagraph" class="p" id="20220120170830-khev9v0" updated="20220120171000"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 251px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/2019_grid_x2_y07-20220120170855-gtuncq4.jpg" data-src="assets/2019_grid_x2_y07-20220120170855-gtuncq4.jpg" alt="2019_grid_x2_y07.jpg" style="width: 241px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span><span contenteditable="false" data-type="img" class="img" style="max-width: 251px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/2020_grid_x04_y09-20220120170912-a1yji2f.png" data-src="assets/2020_grid_x04_y09-20220120170912-a1yji2f.png" alt="2020_grid_x04_y09.png" style="width: 241px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span><span contenteditable="false" data-type="img" class="img" style="max-width: 251px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/2021a_grid_x03_y05-20220120171000-rze68yw.jpg" data-src="assets/2021a_grid_x03_y05-20220120171000-rze68yw.jpg" alt="2021a_grid_x03_y05.jpg" style="width: 241px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120171028-nw7c077" data-type="NodeListItem" class="li" id="20220120171028-nw7c077"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120171028-se2ho1l" data-type="NodeParagraph" class="p" id="20220120171028-se2ho1l" updated="20220120171132"><div contenteditable="false" spellcheck="false"><code>dom_slice_save_folder</code>: the folder to save clipped dom regions</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120171101-f7b73gf" data-type="NodeListItem" class="li" id="20220120171101-f7b73gf"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120171101-wstfcsc" data-type="NodeParagraph" class="p" updated="20220120171346" id="20220120171101-wstfcsc"><div contenteditable="false" spellcheck="false"><code>dom_slice_save_format</code>: jpg, png, or tif (with geo info, not necessary for this detection)</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120171351-75c9e1y" data-type="NodeListItem" class="li" id="20220120171351-75c9e1y"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120171351-s0v61yy" data-type="NodeParagraph" class="p" id="20220120171351-s0v61yy" updated="20220120171431"><div contenteditable="false" spellcheck="false"><code>dom_slice_length</code>: the size of each small regions, unit is pixel</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120171431-lf4zcph" data-type="NodeListItem" class="li" id="20220120171431-lf4zcph" updated="20220120173252"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120171431-thkjluf" data-type="NodeParagraph" class="p" id="20220120171431-thkjluf" updated="20220120171457"><div contenteditable="false" spellcheck="false"><code>dom_slice_buffer</code>: the length of buffered regions, unit is pixel</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120171458-z268qf0" data-type="NodeParagraph" class="p" id="20220120171458-z268qf0" updated="20220120171721"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 244px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120171721-m7hux5e.png" data-src="assets/image-20220120171721-m7hux5e.png" alt="image.png" style="width: 234px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120173218-zqy2z39" data-type="NodeParagraph" class="p" id="20220120173218-zqy2z39" updated="20220120173252"><div contenteditable="false" spellcheck="false">The green part is the buffer region to avoid imcompete broccoli on edge, 200 pixel extend to right and bottom</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120170638-qaprurf" data-type="NodeParagraph" class="p" id="20220120170638-qaprurf" updated="20220120171825"><div contenteditable="false" spellcheck="false">Then you can run the script by:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120171825-pmdjrgz" data-type="NodeCodeBlock" class="code-block" id="20220120171825-pmdjrgz" updated="20220120172819"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">bash</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false"># please cd to the folder 11_root_pos first
path/to/github/UAVbroccoli/11_root_pos&gt; conda activate uavbroccoli
(uavbroccoli)path/to/github/UAVbroccoli/11_root_pos&gt; python 01_slice_dom.py
grid_x15_y13.jpg | 100.0 % done | 19 s passed, 0 s left
Cost 19 s in total
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120144308-a2wj3mu" data-type="NodeParagraph" class="p" id="20220120144308-a2wj3mu" updated="20220120172827"><div contenteditable="false" spellcheck="false">Will get the following results:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120144308-0z1ggwy" data-type="NodeCodeBlock" class="code-block" id="20220120144308-0z1ggwy" updated="20220120182447"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">bash</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">11_root_position
└── jpg
    ├── broccoli_tanashi_5_20211101_0_dom.tif
    │   ├── grid_x00_y02.jpg
    │   ├── grid_x00_y03.jpg
    │   ├── ...
    │   └── grid_x14_y11.jpg
    └── broccoli_tanashi_5_20211101_0_dom.tif.json
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120173055-gee1v0r" data-type="NodeHeading" class="h2" id="20220120173055-gee1v0r" updated="20220120173600"><div contenteditable="false" spellcheck="false">3.2 Prepare yolo data</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120173603-su48m2r" data-type="NodeParagraph" class="p" id="20220120173603-su48m2r" updated="20220120173848"><div contenteditable="false" spellcheck="false">First, run <code>labelme.exe</code> to annotate training data for yolov5.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120173850-utym85z" data-type="NodeList" class="list" id="20220120173850-utym85z" updated="20220120181035"><div data-marker="*" data-subtype="u" data-node-id="20220120173913-yvu2pjb" data-type="NodeListItem" class="li" id="20220120173913-yvu2pjb" updated="20220120181035"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120173913-s1u68vb" data-type="NodeParagraph" class="p" id="20220120173913-s1u68vb" updated="20220120181035"><div contenteditable="false" spellcheck="false">Remember to <strong>unclick</strong> the &quot;save with image data&quot;, otherwise it will make a huge training data json file</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120173719-78dlgxt" data-type="NodeParagraph" class="p" id="20220120173719-78dlgxt" updated="20220120173758"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 273px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120173758-i716kli.png" data-src="assets/image-20220120173758-i716kli.png" alt="image.png" style="width: 263px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120173926-y9jvgvo" data-type="NodeListItem" class="li" id="20220120173926-y9jvgvo"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120173926-h442w9t" data-type="NodeParagraph" class="p" id="20220120173926-h442w9t" updated="20220120174032"><div contenteditable="false" spellcheck="false">Then, Open Dir (<kbd>Ctrl</kbd> +<kbd>U</kbd>), choose the previous <code>jpg/broccoli_tanashi_5_20211101_0_dom.tif</code> folder</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120174206-kte21um" data-type="NodeListItem" class="li" id="20220120174206-kte21um"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120174206-v8ofzdi" data-type="NodeParagraph" class="p" id="20220120174206-v8ofzdi" updated="20220120174318"><div contenteditable="false" spellcheck="false">Select 1-2 representative images at file list, then <code>Edit -&gt; create Rectange</code></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120174229-pkw2dd2" data-type="NodeParagraph" class="p" id="20220120174229-pkw2dd2" updated="20220120174230"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 528px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120174230-wali0y4.png" data-src="assets/image-20220120174230-wali0y4.png" alt="image.png" style="width: 518px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120174320-2jn0emn" data-type="NodeListItem" class="li" id="20220120174320-2jn0emn"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120174320-udvwn5c" data-type="NodeParagraph" class="p" id="20220120174320-udvwn5c" updated="20220120174427"><div contenteditable="false" spellcheck="false">Draw one rectange, and name the label name</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120174355-mak762k" data-type="NodeParagraph" class="p" id="20220120174355-mak762k" updated="20220120174356"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 420px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120174356-45pa9ty.png" data-src="assets/image-20220120174356-45pa9ty.png" alt="image.png" style="width: 410px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120174410-zyeqxzt" data-type="NodeListItem" class="li" id="20220120174410-zyeqxzt"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120174410-ncj6krp" data-type="NodeParagraph" class="p" id="20220120174410-ncj6krp" updated="20220120174540"><div contenteditable="false" spellcheck="false">Repeat previous step to mark all buds, and alwasy use the previous label name (<strong>don't</strong> change to bud1, bud2, etc.)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120174718-jvciv7o" data-type="NodeParagraph" class="p" id="20220120174718-jvciv7o" updated="20220120174910"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 745px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120174910-llvmcmj.png" data-src="assets/image-20220120174910-llvmcmj.png" alt="image.png" title="The incomplete bud at edge also need to be labeled" style="width: 735px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title">The incomplete bud at edge also need to be labeled</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120174544-whse1xc" data-type="NodeListItem" class="li" id="20220120174544-whse1xc"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120174544-2wzjxjz" data-type="NodeParagraph" class="p" id="20220120174544-2wzjxjz" updated="20220120175022"><div contenteditable="false" spellcheck="false">Then save as, choose a proper folder to save json file (don't rename json file, just leave as default)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120174548-c5n5ciu" data-type="NodeParagraph" class="p" id="20220120174548-c5n5ciu" updated="20220120175050"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 320px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120174548-wzdl7zv.png" data-src="assets/image-20220120174548-wzdl7zv.png" alt="image.png" style="width: 310px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120175053-ztxlg9f" data-type="NodeParagraph" class="p" id="20220120175053-ztxlg9f"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120175050-3c7575s.png" data-src="assets/image-20220120175050-3c7575s.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120175059-n2rz3yj" data-type="NodeListItem" class="li" id="20220120175059-n2rz3yj" updated="20220120175220"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120175059-p87dz5l" data-type="NodeParagraph" class="p" id="20220120175059-p87dz5l" updated="20220120175124"><div contenteditable="false" spellcheck="false">Repeat previous steps, label 2-3 representative images</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120175126-rejpd9t" data-type="NodeParagraph" class="p" updated="20220120175220" id="20220120175126-rejpd9t"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120175220-qmb9lw7.png" data-src="assets/image-20220120175220-qmb9lw7.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120173604-njuin6d" data-type="NodeParagraph" class="p" id="20220120173604-njuin6d" updated="20220120175303"><div contenteditable="false" spellcheck="false">Then run edit the config.py, to specify the labeled folder:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120175303-m3rudy7" data-type="NodeCodeBlock" class="code-block" id="20220120175303-m3rudy7" updated="20220120175414"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">############################
# 02 prepare yolo database #
############################
labelme_json_data_pool = {
    # data_id: folder contains labelme json
    &quot;2021a&quot;:f&quot;{project_data_folder}/{working_spacename}/labelme_json&quot;,  # 2021 autumn train data  
    # also acceptable for several different folders as total training data pool
    &quot;2021s&quot;:&quot;Z:/hwang_Pro/data/2021_tanashi_broccoli/11_instance_seg/yolo_json&quot;, # 2021 summer train data
    &quot;2020&quot;:&quot;Z:/hwang_Pro/data/2020_tanashi_broccoli/11_instance_seg/yolo_json&quot;, # 2020 train data
    &quot;2019&quot;:&quot;Z:/hwang_Pro/data/2019_tanashi_broccoli5/11_instance_seg/yolo_json&quot;,  #2019 train data
}
train_database_path = f&quot;{project_data_folder}/{working_spacename}/yolo_train/training_database&quot;
# optional
train_database_name = &quot;broccoli_root&quot;
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120175303-ajqfcxk" data-type="NodeList" class="list" id="20220120175303-ajqfcxk" updated="20220120180249"><div data-marker="*" data-subtype="u" data-node-id="20220120175430-57yhxg5" data-type="NodeListItem" class="li" id="20220120175430-57yhxg5"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120175430-0n5ol2y" data-type="NodeParagraph" class="p" id="20220120175430-0n5ol2y" updated="20220120175605"><div contenteditable="false" spellcheck="false"><code>labelme_json_data_pool</code>: you can add all your training data folder of different year, please use python dictionary:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120175605-dmyclvu" data-type="NodeCodeBlock" class="code-block" id="20220120175605-dmyclvu" updated="20220120175635"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">{&quot;key1&quot;: &quot;path1&quot;, &quot;key2&quot;: &quot;path2&quot;}
</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120175639-o3dstnq" data-type="NodeListItem" class="li" id="20220120175639-o3dstnq"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120175639-fwkalv3" data-type="NodeParagraph" class="p" id="20220120175639-fwkalv3" updated="20220120175712"><div contenteditable="false" spellcheck="false"><code>train_database_path</code>: the folder to please organized training data, recommend to leave it as default</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120175718-6i60zxk" data-type="NodeListItem" class="li" id="20220120175718-6i60zxk" updated="20220120180249"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120175718-wm0qrku" data-type="NodeParagraph" class="p" id="20220120175718-wm0qrku" updated="20220120180249"><div contenteditable="false" spellcheck="false"><code>train_database_name</code>: recommended leave it as default, or any other name you like</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120180815-wxbxwen" data-type="NodeCodeBlock" class="code-block" id="20220120180815-wxbxwen" updated="20220120180828"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">bash</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false"># please cd to the folder 11_root_pos first
(uavbroccoli)path/to/github/UAVbroccoli/11_root_pos&gt; python 02_prepare_yolo_data.py
Training database successfully prepared
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120180801-42r7rxe" data-type="NodeParagraph" class="p" id="20220120180801-42r7rxe" updated="20220120180932"><div contenteditable="false" spellcheck="false">Will get the following data structure:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120180933-xzww4kv" data-type="NodeCodeBlock" class="code-block" id="20220120180933-xzww4kv" updated="20220120182502"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">plaintxt</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">11_root_position/yolo_train
├── training_database
│   ├── images
│   │   ├── train
│   │   │   ├── 2019_grid_x2_y07.jpg
│   │   │   ├── ...
│   │   │   ├── 2021s_grid_x1_y03.jpg
│   │   │   └── 2021s_grid_x3_y05.jpg
│   │   └── validation
│   │       ├── 2019_grid_x2_y07.jpg
│   │       ├── ...
│   │       ├── 2021s_grid_x1_y03.jpg
│   │       └── 2021s_grid_x3_y05.jpg
│   └── labels
│       ├── train
│       │   ├── 2019_grid_x2_y07.txt
│       │   ├── ...
│       │   ├── 2021s_grid_x1_y03.txt
│       │   └── 2021s_grid_x3_y05.txt
│       └── validation
│           ├── 2019_grid_x2_y07.txt
│           ├── ...
│           ├── 2021s_grid_x1_y03.txt
│           └── 2021s_grid_x3_y05.txt
└── training_database.yaml
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120180727-qrvzhwc" data-type="NodeHeading" class="h2" id="20220120180727-qrvzhwc" updated="20220120181117"><div contenteditable="false" spellcheck="false">3.3 Train yolov5 models</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120181118-k85f3g2" data-type="NodeParagraph" class="p" id="20220120181118-k85f3g2" updated="20220120181135"><div contenteditable="false" spellcheck="false">Please change the following in <code>config.py</code></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120181136-wqsl6ty" data-type="NodeCodeBlock" class="code-block" id="20220120181136-wqsl6ty" updated="20220120182102"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">#######################
# 03 train yolo model #
#######################
yolo_model_image_size = 1500  # optional
yolo_model_batch_size = 8
yolo_model_epochs = 300
yolo_model_structure_config = &quot;../yolov5/models/yolov5s.yaml&quot;
yolo_model_name = &quot;br&quot;
yolo_model_save_path = f&quot;{project_data_folder}/{working_spacename}/yolo_train/runs&quot;
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120181158-s0kv46l" data-type="NodeList" class="list" id="20220120181158-s0kv46l" updated="20220120182140"><div data-marker="*" data-subtype="u" data-node-id="20220120181202-n5hbeg0" data-type="NodeListItem" class="li" id="20220120181202-n5hbeg0"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120181202-k6ptd1w" data-type="NodeParagraph" class="p" id="20220120181202-k6ptd1w" updated="20220120181244"><div contenteditable="false" spellcheck="false"><code>yolo_model_image_size</code>: the resize size of model for different input images</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120181253-hbfsj4p" data-type="NodeListItem" class="li" id="20220120181253-hbfsj4p"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120181253-am1tixh" data-type="NodeParagraph" class="p" id="20220120181253-am1tixh" updated="20220120181327"><div contenteditable="false" spellcheck="false"><code>yolo_model_batch_size</code>: change at your need, default 8 should work</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120181327-alm2hv2" data-type="NodeListItem" class="li" id="20220120181327-alm2hv2"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120181327-pz6kbp5" data-type="NodeParagraph" class="p" updated="20220120181436" id="20220120181327-pz6kbp5"><div contenteditable="false" spellcheck="false"><code>yolo_model_epochs</code>: smaller will faster, but too small may result in an incomplete model training</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120181436-f3qhi5m" data-type="NodeListItem" class="li" updated="20220120182140" id="20220120181436-f3qhi5m"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120181436-67uy2si" data-type="NodeParagraph" class="p" id="20220120181436-67uy2si" updated="20220120182140"><div contenteditable="false" spellcheck="false"><code>yolo_model_structure_config</code>: in our case, the training data is too small, only small model (<code>yolo v5 small</code>) can be trained. Here uses relative path to <code>yolov5 folder</code>, please do not change</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120181534-xpcn89o" data-type="NodeListItem" class="li" id="20220120181534-xpcn89o"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120181534-w2747y4" data-type="NodeParagraph" class="p" id="20220120181534-w2747y4" updated="20220120181729"><div contenteditable="false" spellcheck="false"><code>yolo_model_name</code>: change at your need, default <code>broccoli_root -&gt; br</code></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120181730-vfcc10n" data-type="NodeListItem" class="li" id="20220120181730-vfcc10n" updated="20220120181758"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120181730-pbnvzrf" data-type="NodeParagraph" class="p" id="20220120181730-pbnvzrf" updated="20220120181758"><div contenteditable="false" spellcheck="false"><code>yolo_model_save_path</code>: place to save trained model, recommend to leave it as default</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120181816-muaefbp" data-type="NodeCodeBlock" class="code-block" id="20220120181816-muaefbp" updated="20220120183753"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">bash</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false"># please cd to the folder 11_root_pos first
(uavbroccoli)path/to/github/UAVbroccoli/11_root_pos&gt; python 03_train_yolov5.py
&gt;&gt;&gt;python ../yolov5/train.py --img 1500 --batch 8 --epochs 300 --data E:/2022_tanashi_broccoli/11_root_position/yolo_train/training_database.yaml --cfg ../yolov5/models/yolov5s.yaml --name br --project E:/2022_tanashi_broccoli/11_root_position/yolo_train/runs --workers 0
train: weights=..\yolov5\yolov5s.pt, cfg=../yolov5/models/yolov5s.yaml, data=E:/2022_tanashi_broccoli/11_root_position/yolo_train/training_database.yaml, hyp=..\yolov5\data\hyps\hyp.scratch.yaml, epochs=300, batch_size=8, imgsz=1500, rect=False, resume=False, nosave=False, noval=False, noautoanchor=False, evolve=None, bucket=, cache=None, image_weights=False, device=, multi_scale=False, single_cls=False, optimizer=SGD, sync_bn=False, workers=0, project=E:/2022_tanashi_broccoli/11_root_position/yolo_train/runs, name=br, exist_ok=False, quad=False, linear_lr=False, label_smoothing=0.0, patience=100, freeze=[0], save_period=-1, local_rank=-1, entity=None, upload_dataset=False, bbox_interval=-1, artifact_alias=latest
github: skipping check (not a git repository), for updates see https://github.com/ultralytics/yolov5
YOLOv5  2022-1-20 torch 1.8.2+cu111 CUDA:0 (NVIDIA GeForce RTX 3090, 24576MiB)

hyperparameters: lr0=0.01, lrf=0.1, momentum=0.937, weight_decay=0.0005, warmup_epochs=3.0, warmup_momentum=0.8, warmup_bias_lr=0.1, box=0.05, cls=0.5, cls_pw=1.0, obj=1.0, obj_pw=1.0, iou_t=0.2, anchor_t=4.0, fl_gamma=0.0, hsv_h=0.015, hsv_s=0.7, hsv_v=0.4, degrees=0.0, translate=0.1, scale=0.5, shear=0.0, perspective=0.0, flipud=0.0, fliplr=0.5, mosaic=1.0, mixup=0.0, copy_paste=0.0
Weights &amp; Biases: run 'pip install wandb' to automatically track and visualize YOLOv5  runs (RECOMMENDED)
TensorBoard: Start with 'tensorboard --logdir E:\2022_tanashi_broccoli\11_root_position\yolo_train\runs', view at http://localhost:6006/
Overriding model.yaml nc=80 with nc=1

                 from  n    params  module                                  arguments
  0                -1  1      3520  models.common.Conv                      [3, 32, 6, 2, 2]
...
 24      [17, 20, 23]  1     16182  models.yolo.Detect                      [1, [[10, 13, 16, 30, 33, 23], [30, 61, 62, 45, 59, 119], [116, 90, 156, 198, 373, 326]], [128, 256, 512]]
Model Summary: 270 layers, 7022326 parameters, 7022326 gradients, 15.8 GFLOPs

Transferred 342/349 items from ..\yolov5\yolov5s.pt
WARNING: --img-size 1500 must be multiple of max stride 32, updating to 1504
Scaled weight_decay = 0.0005
optimizer: SGD with parameter groups 57 weight (no decay), 60 weight, 60 bias
train: Scanning 'E:\2022_tanashi_broccoli\11_root_position\yolo_train\training_database\labels\train' images and labels
train: New cache created: E:\2022_tanashi_broccoli\11_root_position\yolo_train\training_database\labels\train.cache
val: Scanning 'E:\2022_tanashi_broccoli\11_root_position\yolo_train\training_database\labels\validation' images and lab
val: New cache created: E:\2022_tanashi_broccoli\11_root_position\yolo_train\training_database\labels\validation.cache
module 'signal' has no attribute 'SIGALRM'

AutoAnchor: 6.28 anchors/target, 1.000 Best Possible Recall (BPR). Current anchors are a good fit to dataset
Image sizes 1504 train, 1504 val
Using 0 dataloader workers
Logging results to E:\2022_tanashi_broccoli\11_root_position\yolo_train\runs\br
Starting training for 300 epochs...

     Epoch   gpu_mem       box       obj       cls    labels  img_size
     0/299     7.28G    0.1192      0.81         0       983      1504: 100%|██████████| 1/1 [00:03&lt;00:00,  3.57s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|██████████| 1/1 [00:00&lt;00:
                 all          7        728    0.00236    0.00412   0.000722   0.000217

...
     Epoch   gpu_mem       box       obj       cls    labels  img_size
   299/299     7.97G   0.04732    0.4038         0       769      1504: 100%|██████████| 1/1 [00:01&lt;00:00,  1.28s/it]
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|██████████| 1/1 [00:00&lt;00:
                 all          7        728      0.889      0.849      0.939      0.552

300 epochs completed in 0.183 hours.
Optimizer stripped from E:\2022_tanashi_broccoli\11_root_position\yolo_train\runs\br\weights\last.pt, 15.4MB
Optimizer stripped from E:\2022_tanashi_broccoli\11_root_position\yolo_train\runs\br\weights\best.pt, 15.4MB

Validating E:\2022_tanashi_broccoli\11_root_position\yolo_train\runs\br\weights\best.pt...
Fusing layers...
Model Summary: 213 layers, 7012822 parameters, 0 gradients, 15.8 GFLOPs
               Class     Images     Labels          P          R     mAP@.5 mAP@.5:.95: 100%|██████████| 1/1 [00:00&lt;00:
                 all          7        728      0.883      0.859      0.939      0.554
Results saved to E:\2022_tanashi_broccoli\11_root_position\yolo_train\runs\br
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120181201-9ozqx54" data-type="NodeParagraph" class="p" id="20220120181201-9ozqx54" updated="20220120183857"><div contenteditable="false" spellcheck="false">Please keep mind the last line: <code>Results saved to ...\11_root_position\yolo_train\runs\br</code></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120183914-pvasrh5" data-type="NodeParagraph" class="p" id="20220120183914-pvasrh5" updated="20220120184253"><div contenteditable="false" spellcheck="false">Go to that folder, and check the <code>results.png</code>, especially the last column</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120184023-5z17c15" data-type="NodeParagraph" class="p" id="20220120184023-5z17c15" updated="20220120184023"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 580px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/74ac8ec891da2a5763955bb160861f8-20220118160056-w3e34p3.png" data-src="assets/74ac8ec891da2a5763955bb160861f8-20220118160056-w3e34p3.png" alt="74ac8ec891da2a5763955bb160861f8.png" title="Bad training with epoch=100, low Recall and mAP" /><span class="protyle-action__drag"></span><span class="protyle-action__title">Bad training with epoch=100, low Recall and mAP</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120184023-39iesj6" data-type="NodeParagraph" class="p" id="20220120184023-39iesj6" updated="20220120184023"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 580px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220118160143-ninui99.png" data-src="assets/image-20220118160143-ninui99.png" alt="image.png" title="Good training with epoch=300, high Recall and medium mAP" /><span class="protyle-action__drag"></span><span class="protyle-action__title">Good training with epoch=300, high Recall and medium mAP</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120144308-vfs5lxr" data-type="NodeParagraph" class="p" id="20220120144308-vfs5lxr" updated="20220120184357"><div contenteditable="false" spellcheck="false">You need to change previous setting and retrain until get recall &gt; 0.7 and mAP &gt; 0.5, and record the final path of models: <code>Results saved to ...\11_root_position\yolo_train\runs\br_x</code></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120184334-tfcxevm" data-type="NodeHeading" class="h2" id="20220120184334-tfcxevm" updated="20220120191409"><div contenteditable="false" spellcheck="false">3.4 Apply trained models</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120191411-i5rn81t" data-type="NodeParagraph" class="p" updated="20220120191614" id="20220120191411-i5rn81t"><div contenteditable="false" spellcheck="false">Then change the following parameters in <code>config.py</code></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120191615-qpg42c9" data-type="NodeCodeBlock" class="code-block" id="20220120191615-qpg42c9" updated="20220120191622"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">#######################
# 04 apply yolo model #
#######################
yolo_apply_results_folder = f&quot;{project_data_folder}/{working_spacename}/yolo_results&quot;

# please check carefully of model ouptuts, need change every time when run scripts!
yolo_apply_weights_path = f&quot;{yolo_model_save_path}/br/weights/best.pt&quot;

yolo_apply_confidence_threshold = 0.3  # please edit this according to your results
yolo_apply_iou_threshold = 0
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120184334-ztkk4si" data-type="NodeList" class="list" id="20220120184334-ztkk4si" updated="20220120192607"><div data-marker="*" data-subtype="u" data-node-id="20220120191637-8vdmpt3" data-type="NodeListItem" class="li" id="20220120191637-8vdmpt3"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120191637-lmdkb3t" data-type="NodeParagraph" class="p" id="20220120191637-lmdkb3t" updated="20220120191738"><div contenteditable="false" spellcheck="false"><code>yolo_apply_results_folder</code>: the path to save final detected results, recommend to just leave as default</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120191739-su8y6am" data-type="NodeListItem" class="li" id="20220120191739-su8y6am"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120191739-mrpiamj" data-type="NodeParagraph" class="p" id="20220120191739-mrpiamj" updated="20220120191941"><div contenteditable="false" spellcheck="false"><code>yolo_apply_weights_path</code>: the model path want to use, please <strong>check this carefully</strong>, because train different models will get different folders, <code>br</code>, <code>br1</code>, <code>br2</code>, ... <strong>ensure you picked the correct one</strong>.</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120191941-neu096x" data-type="NodeListItem" class="li" updated="20220120192607" id="20220120191941-neu096x"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120191941-3ardpz8" data-type="NodeParagraph" class="p" id="20220120191941-3ardpz8" updated="20220120192026"><div contenteditable="false" spellcheck="false"><code>yolo_apply_confidence_threshold</code>: the threshold to remove low condicence results, you can edit it according to your own results.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120192257-cfk5zpq" data-type="NodeParagraph" class="p" id="20220120192257-cfk5zpq" updated="20220120192607"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 577px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120192607-c9e3x8d.png" data-src="assets/image-20220120192607-c9e3x8d.png" alt="image.png" title="thres_value, don&apos;t too worry about the wrong detect of weed outside plot" style="width: 567px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title">thres_value, don't too worry about the wrong detect of weed outside plot</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120192256-7lq8x3a" data-type="NodeListItem" class="li" updated="20220120192425" id="20220120192256-7lq8x3a"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120192256-5ar6wzg" data-type="NodeParagraph" class="p" id="20220120192256-5ar6wzg" updated="20220120192425"><div contenteditable="false" spellcheck="false"><code>yolo_apply_iou_threshold</code>: leave it default as 0 unless you have good understanding about this parameter <code>--iou-thres</code> in yolov5</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120192727-2gy7274" data-type="NodeCodeBlock" class="code-block" id="20220120192727-2gy7274" updated="20220120192836"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">bash</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false"># please cd to the folder 11_root_pos first
(uavbroccoli)path/to/github/UAVbroccoli/11_root_pos&gt; &gt;python 04_apply_yolov5.py
&gt;&gt;&gt;python ../yolov5/detect.py --source E:/2022_tanashi_broccoli/11_root_position\jpg\broccoli_tanashi_5_20211101_0_dom.tif --weights E:/2022_tanashi_broccoli/11_root_position/yolo_train/runs/br/weights/best.pt --imgsz 1500 --conf-thres 0.3 --iou-thres 0 --save-txt --save-conf --project E:/2022_tanashi_broccoli/11_root_position/yolo_results
detect: weights=['E:/2022_tanashi_broccoli/11_root_position/yolo_train/runs/br/weights/best.pt'], source=E:/2022_tanashi_broccoli/11_root_position\jpg\broccoli_tanashi_5_20211101_0_dom.tif, data=..\yolov5\data\coco128.yaml, imgsz=[1500, 1500], conf_thres=0.3, iou_thres=0.0, max_det=1000, device=, view_img=False, save_txt=True, save_conf=True, save_crop=False, nosave=False, classes=None, agnostic_nms=False, augment=False, visualize=False, update=False, project=E:/2022_tanashi_broccoli/11_root_position/yolo_results, name=exp, exist_ok=False, line_thickness=3, hide_labels=False, hide_conf=False, half=False, dnn=False
YOLOv5  2022-1-20 torch 1.8.2+cu111 CUDA:0 (NVIDIA GeForce RTX 3090, 24576MiB)

Fusing layers...
Model Summary: 213 layers, 7012822 parameters, 0 gradients, 15.8 GFLOPs
WARNING: --img-size [1500, 1500] must be multiple of max stride 32, updating to [1504, 1504]
image 1/172 E:\2022_tanashi_broccoli\11_root_position\jpg\broccoli_tanashi_5_20211101_0_dom.tif\grid_x00_y02.jpg: 1504x1504 Done. (0.012s)
...
image 172/172 E:\2022_tanashi_broccoli\11_root_position\jpg\broccoli_tanashi_5_20211101_0_dom.tif\grid_x14_y11.jpg: 1504x1504 Done. (0.011s)
Speed: 1.2ms pre-process, 12.3ms inference, 1.3ms NMS per image at shape (1, 3, 1504, 1504)
Results saved to E:\2022_tanashi_broccoli\11_root_position\yolo_results\exp
156 labels saved to E:\2022_tanashi_broccoli\11_root_position\yolo_results\exp\labels
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120191631-1ztobc2" data-type="NodeParagraph" class="p" id="20220120191631-1ztobc2" updated="20220120192916"><div contenteditable="false" spellcheck="false">Will get results like this:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120192916-yvasj7p" data-type="NodeParagraph" class="p" id="20220120192916-yvasj7p" updated="20220120192917"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120192917-ic2uwjs.png" data-src="assets/image-20220120192917-ic2uwjs.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120192917-i7fst4x" data-type="NodeParagraph" class="p" id="20220120192917-i7fst4x" updated="20220120193042"><div contenteditable="false" spellcheck="false">Please manual and randomly check these results, you can add the bad performance ones to training data, and repeat steps 3.2 to 3.4, until almost get a good detection results.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120192918-dszpizj" data-type="NodeHeading" class="h2" id="20220120192918-dszpizj" updated="20220120193644"><div contenteditable="false" spellcheck="false">3.5 Change yolo results to shp file</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120193643-qcwpppf" data-type="NodeParagraph" class="p" updated="20220120193744" id="20220120193643-qcwpppf"><div contenteditable="false" spellcheck="false">All the yolo results are labels in txt file, editing the following parameters to change them to GIS formats (shapefiles.shp)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120193745-6eru2a0" data-type="NodeCodeBlock" class="code-block" id="20220120193745-6eru2a0" updated="20220120202505"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">########################
# 05 yolo to shapefile #
########################
# please use QGIS to make a rectange bounding box of fields (very tight to crops)
field_rectange_bounding_box_shapefile = f&quot;{project_data_folder}/02_GIS/plot_edge_for_yolo.shp&quot;
# please check carefully about this:
yolo_apply_label_folder = f&quot;{yolo_apply_results_folder}/exp/labels&quot;
shapefile_save_folder = f&quot;{project_data_folder}/{working_spacename}/shapefiles&quot;
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120192918-1zwrhj3" data-type="NodeList" class="list" id="20220120192918-1zwrhj3" updated="20220120193811"><div data-marker="*" data-subtype="u" data-node-id="20220120193811-q8bvnb4" data-type="NodeListItem" class="li" id="20220120193811-q8bvnb4"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120193811-wgwi94y" data-type="NodeParagraph" class="p" id="20220120193811-wgwi94y" updated="20220120193901"><div contenteditable="false" spellcheck="false"><code>field_rectange_bounding_box_shapefile</code>: this is the tight bounding of fields, it will be used to remove wrong weed detection outside plot, and will also guied the ridge direction for later use</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120193904-u36hs3w" data-type="NodeParagraph" class="p" id="20220120193904-u36hs3w" updated="20220120193951"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120193951-ykoav8x.png" data-src="assets/image-20220120193951-ykoav8x.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120193958-gkml9nk" data-type="NodeParagraph" class="p" updated="20220120194017" id="20220120193958-gkml9nk"><div contenteditable="false" spellcheck="false">The operation of QGIS to make this file will be introduced later</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120194011-l29ivaj" data-type="NodeListItem" class="li" id="20220120194011-l29ivaj"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120194011-4k2on1t" data-type="NodeParagraph" class="p" updated="20220120194209" id="20220120194011-4k2on1t"><div contenteditable="false" spellcheck="false"><code>yolo_apply_label_folder</code>: the path of labels, but again <strong>carefully check the path</strong>, it will give <code>exp</code>, <code>exp1</code>, <code>exp2</code>, etc., with you apply model for several times.</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220120194232-gdmug5b" data-type="NodeListItem" class="li" id="20220120194232-gdmug5b"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220120194232-8fztpc6" data-type="NodeParagraph" class="p" id="20220120194232-8fztpc6" updated="20220120194257"><div contenteditable="false" spellcheck="false"><code>shapefile_save_folder</code>: the path to save output shapefiles, recommend to just leave it as default</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h3" data-node-id="20220120194336-8e00rg3" data-type="NodeHeading" class="h3" id="20220120194336-8e00rg3" updated="20220120225405"><div contenteditable="false" spellcheck="false">1) How to make previous bounding rectanges in QGIS</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="o" data-node-id="20220120194354-1g27u70" data-type="NodeList" class="list" id="20220120194354-1g27u70" updated="20220120201823"><div data-marker="1." data-subtype="o" data-node-id="20220120194401-k88jse4" data-type="NodeListItem" class="li" id="20220120194401-k88jse4"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">1.</div><div data-node-id="20220120194401-dnk8env" data-type="NodeParagraph" class="p" id="20220120194401-dnk8env" updated="20220120194503"><div contenteditable="false" spellcheck="false">Open QGIS and drag DOM into the GUI first</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120194503-4uv62wv" data-type="NodeParagraph" class="p" id="20220120194503-4uv62wv" updated="20220120194505"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120194505-evayivw.png" data-src="assets/image-20220120194505-evayivw.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="2." data-subtype="o" data-node-id="20220120194431-lnby50j" data-type="NodeListItem" class="li" id="20220120194431-lnby50j" updated="20220120201823"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">2.</div><div data-node-id="20220120194431-zwfkh3c" data-type="NodeParagraph" class="p" updated="20220120194753" id="20220120194431-zwfkh3c"><div contenteditable="false" spellcheck="false">Edit the rotation to place the field ridge vertical</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120194736-m2bsgz9" data-type="NodeParagraph" class="p" updated="20220120194738" id="20220120194736-m2bsgz9"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 615px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120194737-05g385z.png" data-src="assets/image-20220120194737-05g385z.png" alt="image.png" style="width: 605px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120201746-tif99rx" data-type="NodeParagraph" class="p" id="20220120201746-tif99rx" updated="20220120201823"><div contenteditable="false" spellcheck="false">mouse middle press &amp; hold to drag map, middel scrool to zoom in and out</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="3." data-subtype="o" data-node-id="20220120194758-15wm7bk" data-type="NodeListItem" class="li" id="20220120194758-15wm7bk"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">3.</div><div data-node-id="20220120194758-7kmgypx" data-type="NodeParagraph" class="p" id="20220120194758-7kmgypx" updated="20220120194945"><div contenteditable="false" spellcheck="false">Activate the following toolvars (<code>view -&gt; toolbars</code>)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120194947-e82wrod" data-type="NodeParagraph" class="p" updated="20220120194954" id="20220120194947-e82wrod"><div contenteditable="false" spellcheck="false">Advanced Digitizing Toolbar</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120194955-gh50ick" data-type="NodeParagraph" class="p" id="20220120194955-gh50ick" updated="20220120195003"><div contenteditable="false" spellcheck="false">Digitizing Toolbar</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195007-lqaszu0" data-type="NodeParagraph" class="p" id="20220120195007-lqaszu0" updated="20220120195020"><div contenteditable="false" spellcheck="false">Shape Digitizing Toolbar</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120194807-5kbftnb" data-type="NodeParagraph" class="p" updated="20220120194919" id="20220120194807-5kbftnb"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120194919-353zw8s.png" data-src="assets/image-20220120194919-353zw8s.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195026-pnnq5bj" data-type="NodeParagraph" class="p" id="20220120195026-pnnq5bj" updated="20220120195103"><div contenteditable="false" spellcheck="false">Then your panel will look like this:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195103-9diz3k8" data-type="NodeParagraph" class="p" id="20220120195103-9diz3k8" updated="20220120195141"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120195141-gxe2svz.png" data-src="assets/image-20220120195141-gxe2svz.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="4." data-subtype="o" data-node-id="20220120195150-jxdgle1" data-type="NodeListItem" class="li" id="20220120195150-jxdgle1"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">4.</div><div data-node-id="20220120195150-zjjlu3d" data-type="NodeParagraph" class="p" id="20220120195150-zjjlu3d" updated="20220120195207"><div contenteditable="false" spellcheck="false">create new shapefile</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195231-dtow0ce" data-type="NodeParagraph" class="p" updated="20220120195231" id="20220120195231-dtow0ce"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120195231-fijhim4.png" data-src="assets/image-20220120195231-fijhim4.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195409-16lh15y" data-type="NodeParagraph" class="p" id="20220120195409-16lh15y" updated="20220120195410"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120195410-frxxh6z.png" data-src="assets/image-20220120195410-frxxh6z.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195415-psofyx0" data-type="NodeParagraph" class="p" id="20220120195415-psofyx0" updated="20220120195438"><div contenteditable="false" spellcheck="false">1 click the <code>...</code> to browse the place to save shp file</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195440-ptdkptr" data-type="NodeParagraph" class="p" id="20220120195440-ptdkptr" updated="20220120195449"><div contenteditable="false" spellcheck="false">2 change geometry type to polygon</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195449-akikf8m" data-type="NodeParagraph" class="p" updated="20220120195530" id="20220120195449-akikf8m"><div contenteditable="false" spellcheck="false">3 Edit the geometry CRS to proper CRS (at least the same with imported DOM)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195535-ntbluq3" data-type="NodeParagraph" class="p" id="20220120195535-ntbluq3" updated="20220120195546"><div contenteditable="false" spellcheck="false">click ok button to create</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120195551-jdhs2yg" data-type="NodeParagraph" class="p" id="20220120195551-jdhs2yg" updated="20220120195558"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120195558-95539n8.png" data-src="assets/image-20220120195558-95539n8.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="5." data-subtype="o" data-node-id="20220120195559-5xdz2bo" data-type="NodeListItem" class="li" id="20220120195559-5xdz2bo"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">5.</div><div data-node-id="20220120195559-hm7u90m" data-type="NodeParagraph" class="p" id="20220120195559-hm7u90m" updated="20220120200018"><div contenteditable="false" spellcheck="false">add a rectange</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120200039-2bh9q2j" data-type="NodeParagraph" class="p" id="20220120200039-2bh9q2j" updated="20220120200057"><div contenteditable="false" spellcheck="false">select created layer, activate the toggle editing tool</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120200033-9ogttfh" data-type="NodeParagraph" class="p" id="20220120200033-9ogttfh" updated="20220120200034"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 490px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120200034-q0s0o8y.png" data-src="assets/image-20220120200034-q0s0o8y.png" alt="image.png" style="width: 480px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120200121-mwdi3tk" data-type="NodeParagraph" class="p" updated="20220120200143" id="20220120200121-mwdi3tk"><div contenteditable="false" spellcheck="false">select the add rectangle from 3 points tool</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120200131-ogo9mtc" data-type="NodeParagraph" class="p" id="20220120200131-ogo9mtc" updated="20220120200132"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120200132-y79au5y.png" data-src="assets/image-20220120200132-y79au5y.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120200146-0e4893z" data-type="NodeParagraph" class="p" id="20220120200146-0e4893z" updated="20220120200400"><div contenteditable="false" spellcheck="false">Add the rectange like this:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120200401-tjjkq3l" data-type="NodeParagraph" class="p" id="20220120200401-tjjkq3l" updated="20220120201338"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 647px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/bbox-20220120201338-iqypko5.gif" data-src="assets/bbox-20220120201338-iqypko5.gif" alt="bbox.gif" title="left click to add points, right click to end points" /><span class="protyle-action__drag"></span><span class="protyle-action__title">left click to add points, right click to end points</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120201404-gokc4lf" data-type="NodeParagraph" class="p" updated="20220120201452" id="20220120201404-gokc4lf"><div contenteditable="false" spellcheck="false">Then click save, and turn off toggle model, and switch to hand tool</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120201453-4z8w5vr" data-type="NodeParagraph" class="p" id="20220120201453-4z8w5vr" updated="20220120201511"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120201511-ezkq1bq.png" data-src="assets/image-20220120201511-ezkq1bq.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="6." data-subtype="o" data-node-id="20220120201521-2ofsjju" data-type="NodeListItem" class="li" id="20220120201521-2ofsjju"><div class="protyle-action protyle-action--order" contenteditable="false" draggable="true">6.</div><div data-node-id="20220120201521-4yxjsqe" data-type="NodeParagraph" class="p" id="20220120201521-4yxjsqe" updated="20220120201611"><div contenteditable="false" spellcheck="false">edit bounding box display properties</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120201605-03z3knc" data-type="NodeParagraph" class="p" id="20220120201605-03z3knc" updated="20220120201624"><div contenteditable="false" spellcheck="false">right click to get into properties panel</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120201554-1lp2df6" data-type="NodeParagraph" class="p" id="20220120201554-1lp2df6" updated="20220120201556"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120201556-cq5v4lj.png" data-src="assets/image-20220120201556-cq5v4lj.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120201701-p5poqey" data-type="NodeParagraph" class="p" id="20220120201701-p5poqey" updated="20220120201715"><div contenteditable="false" spellcheck="false">choose a symbology, and apply -&gt; ok</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120201707-msi99hk" data-type="NodeParagraph" class="p" updated="20220120201708" id="20220120201707-msi99hk"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120201708-n7z52bb.png" data-src="assets/image-20220120201708-n7z52bb.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h3" data-node-id="20220120225412-tyh62fl" data-type="NodeHeading" class="h3" id="20220120225412-tyh62fl" updated="20220120225436"><div contenteditable="false" spellcheck="false">2) Run scripts</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120201921-zsjjrxq" data-type="NodeCodeBlock" class="code-block" linenumber="true" updated="20220120202100" id="20220120201921-zsjjrxq"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">bash</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false"># please cd to the folder 11_root_pos first
(uavbroccoli)path/to/github/UAVbroccoli/11_root_pos&gt; python 05_yolo2shp.py
[io][shp][fields] Shp fields: {'id': 0}
[io][shp][proj] find ESRI projection file E:/2022_tanashi_broccoli/02_GIS/plot_edge_for_yolo.prj, and successfully obtain projection cartesian
Shapefile results saved!
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120202044-95n6gb3" data-type="NodeParagraph" class="p" id="20220120202044-95n6gb3" updated="20220120202115"><div contenteditable="false" spellcheck="false">You will get results like this:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120202115-g64qewz" data-type="NodeParagraph" class="p" id="20220120202115-g64qewz" updated="20220120202142"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120202141-dx8fws9.png" data-src="assets/image-20220120202141-dx8fws9.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120202142-i8j8tpq" data-type="NodeParagraph" class="p" id="20220120202142-i8j8tpq" updated="20220120202600"><div contenteditable="false" spellcheck="false">The <code>keep_bbox</code> (green rectange) and <code>remove_bbox</code> (black rectange) is those buffered region duplications, the <code>unordered_center_points</code> is the green dots in the rectange center.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120202226-b9hr5jc" data-type="NodeParagraph" class="p" id="20220120202226-b9hr5jc" updated="20220120202426"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120202426-07woh01.png" data-src="assets/image-20220120202426-07woh01.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h3" data-node-id="20220120225354-cn7ff6k" data-type="NodeHeading" class="h3" id="20220120225354-cn7ff6k" updated="20220120225739"><div contenteditable="false" spellcheck="false">3) Manual check results (optional)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120225729-jrgf12h" data-type="NodeParagraph" class="p" id="20220120225729-jrgf12h" updated="20220120230134"><div contenteditable="false" spellcheck="false">Ideally, once you selected training data properly, the workflow will given you almost 99% correction detection (100 errors of 11000 broccoli in this case). If you are very care about those errors, you need to manual check these results.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120225814-fuj1a59" data-type="NodeParagraph" class="p" id="20220120225814-fuj1a59" updated="20220120225814"><div contenteditable="false" spellcheck="false">Copy &quot;unordered_center_points&quot; (3 files) and rename to &quot;edited_center_points&quot;, need drag <code>.shp</code> into QGIS, and manual inspect the wrong points</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h4" data-node-id="20220120223102-gxy30aj" data-type="NodeHeading" class="h4" id="20220120223102-gxy30aj" updated="20220120225556"><div contenteditable="false" spellcheck="false"><strong>a. make reference grids</strong></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120203234-4nfoago" data-type="NodeParagraph" class="p" updated="20220120220841" id="20220120203234-4nfoago"><div contenteditable="false" spellcheck="false">You can also make a grid to better distinguish where you have already specified：</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120220842-simx9uh" data-type="NodeParagraph" class="p" updated="20220120220844" id="20220120220842-simx9uh"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 647px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120220844-z2nj6aw.png" data-src="assets/image-20220120220844-z2nj6aw.png" alt="image.png" style="width: 637px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120220555-oxtks8d" data-type="NodeParagraph" class="p" id="20220120220555-oxtks8d" updated="20220120221230"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 637px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120221231-2j7855m.png" data-src="assets/image-20220120221231-2j7855m.png" alt="image.png" title="select a proper distance" style="width: 627px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title">select a proper distance</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120203108-vueu9yo" data-type="NodeParagraph" class="p" id="20220120203108-vueu9yo" updated="20220120221412"><div contenteditable="false" spellcheck="false">will get the following grid:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120221413-qym8tvb" data-type="NodeParagraph" class="p" id="20220120221413-qym8tvb" updated="20220120221440"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 808px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120221440-605bzs9.png" data-src="assets/image-20220120221440-605bzs9.png" alt="image.png" style="width: 798px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120202945-ciompot" data-type="NodeParagraph" class="p" id="20220120202945-ciompot" updated="20220120221549"><div contenteditable="false" spellcheck="false">Go into edit mode, and use selection tool (<kbd>Ctrl</kbd> + <kbd>A</kbd>) to select all, and use rotation tool to rotate, and finally selection those outside boundary, delete them</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120221550-v571rqq" data-type="NodeParagraph" class="p" id="20220120221550-v571rqq" updated="20220120221735"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120221736-msfrtuj.png" data-src="assets/image-20220120221736-msfrtuj.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120202655-1cdnjgp" data-type="NodeParagraph" class="p" id="20220120202655-1cdnjgp" updated="20220120222014"><div contenteditable="false" spellcheck="false">And change the grid layer display, to get the following grid:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120222014-bar8ug1" data-type="NodeParagraph" class="p" id="20220120222014-bar8ug1" updated="20220120222029"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 820px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120222029-bkl8sia.png" data-src="assets/image-20220120222029-bkl8sia.png" alt="image.png" style="width: 810px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120202701-60z89r5" data-type="NodeParagraph" class="p" id="20220120202701-60z89r5" style="color: var(--b3-card-warning-color); background-color: var(--b3-card-warning-background);" updated="20220120222201"><div contenteditable="false" spellcheck="false"><strong parent-style="color: var(--b3-card-warning-color); background-color: var(--b3-card-warning-background);">This grid is also important for later broccoli head segmentation</strong>.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h4" data-node-id="20220120223123-h82cnkp" data-type="NodeHeading" class="h4" id="20220120223123-h82cnkp" updated="20220120225625"><div contenteditable="false" spellcheck="false">b. edit broccoli center points</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121220257-dowspm9" data-type="NodeParagraph" class="p" updated="20220121220431" id="20220121220257-dowspm9" style="color: var(--b3-card-success-color); background-color: var(--b3-card-success-background);"><div contenteditable="false" spellcheck="false">PS: some outlier noise points can be removed by the RANSAC method in the end of 3.6, but has risk of removing correct detection results, not very recommende</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120203035-he5s9a8" data-type="NodeParagraph" class="p" id="20220120203035-he5s9a8" updated="20220120203210"><div contenteditable="false" spellcheck="false">Also change the point display for better view</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120203210-rsm8uf8" data-type="NodeParagraph" class="p" updated="20220120203211" id="20220120203210-rsm8uf8"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120203211-49549fv.png" data-src="assets/image-20220120203211-49549fv.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120203212-elksexo" data-type="NodeParagraph" class="p" id="20220120203212-elksexo" updated="20220120203233"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120203233-diu8b7m.png" data-src="assets/image-20220120203233-diu8b7m.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120202701-wh2tvo1" data-type="NodeParagraph" class="p" id="20220120202701-wh2tvo1" updated="20220120222756"><div contenteditable="false" spellcheck="false">You can do the similar operation (select-delete, select-move) and also add missing points by add polygon tool, to fix the error points of broccoli position</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120222731-npucddy" data-type="NodeParagraph" class="p" id="20220120222731-npucddy" updated="20220120222731"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120222732-skecp99.png" data-src="assets/image-20220120222732-skecp99.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120223227-u223lim" data-type="NodeParagraph" class="p" id="20220120223227-u223lim" style="color: var(--b3-card-info-color); background-color: var(--b3-card-info-background);" updated="20220120223249"><div contenteditable="false" spellcheck="false">Remember to click the <strong parent-style="color: var(--b3-card-info-color); background-color: var(--b3-card-info-background);">save</strong> button frequently to save your work!</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h4" data-node-id="20220120223206-826hucx" data-type="NodeHeading" class="h4" id="20220120223206-826hucx" updated="20220120225653"><div contenteditable="false" spellcheck="false">c. change shortcuts</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120222513-ba7fhzq" data-type="NodeParagraph" class="p" id="20220120222513-ba7fhzq" updated="20220120222928"><div contenteditable="false" spellcheck="false">You can also in settings-&gt; Keyboard Shortcuts</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120222920-pz2o48a" data-type="NodeParagraph" class="p" updated="20220120223009" id="20220120222920-pz2o48a"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120222930-zxu26xv.png" data-src="assets/image-20220120222930-zxu26xv.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120223010-w9vnf7f" data-type="NodeParagraph" class="p" id="20220120223010-w9vnf7f" updated="20220120223010"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120223011-sgzlq9n.png" data-src="assets/image-20220120223011-sgzlq9n.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120222513-o06okkd" data-type="NodeParagraph" class="p" id="20220120222513-o06okkd" updated="20220120223035"><div contenteditable="false" spellcheck="false">To change those common used tools' shortcut to edit more efficiently.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h2" data-node-id="20220120225516-4ihoa3j" data-type="NodeHeading" class="h2" id="20220120225516-4ihoa3j" updated="20220120230333"><div contenteditable="false" spellcheck="false">3.6 Order id by ridge (optional)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120223911-t8xgru2" data-type="NodeParagraph" class="p" id="20220120223911-t8xgru2" updated="20220120224350"><div contenteditable="false" spellcheck="false">After manual editing all parts, if you do not pay too much attention on their id, this step is not necessary at all</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120224351-mzz905n" data-type="NodeParagraph" class="p" id="20220120224351-mzz905n" updated="20220120224352"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 684px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120224352-1fzb4nf.png" data-src="assets/image-20220120224352-1fzb4nf.png" alt="image.png" title="unique but not ordered broccoli id" /><span class="protyle-action__drag"></span><span class="protyle-action__title">unique but not ordered broccoli id</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120224234-ttzdqm9" data-type="NodeParagraph" class="p" id="20220120224234-ttzdqm9" updated="20220120224727"><div contenteditable="false" spellcheck="false">The following scripts will rename the broccoli id along the ridge:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120224728-bfhbe1h" data-type="NodeParagraph" class="p" id="20220120224728-bfhbe1h" updated="20220120224833"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 686px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120224834-b82ti64.png" data-src="assets/image-20220120224834-b82ti64.png" alt="image.png" style="width: 676px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120224213-wi1xxi6" data-type="NodeParagraph" class="p" id="20220120224213-wi1xxi6" updated="20220120233644"><div contenteditable="false" spellcheck="false">Edit the following part in <code>config.py</code>:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120233644-rnzfjw5" data-type="NodeCodeBlock" class="code-block" id="20220120233644-rnzfjw5" updated="20220120234439"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">#####################
# 06 order by ridge #
#####################
edited_center_points_shapefile = f&quot;{shapefile_save_folder}/edited_center_points.shp&quot;
ridge_strength_ratio = 10
ridge_direction = &quot;x&quot;  # if wrong direction, change to &quot;y&quot;
ridge_distance_parameters = 3 # please decrease if some ridge is missing
ridge_height_parameters = 20  # please increase if some bottom small ridge detect as ridge

# optional parameters
ridge_buffer = 0.5   # default is the middle line of two ridges
#      rg1          rg2
# |    [|]    |     [|]
# |&lt;---[|]---&gt;|     [|]
# |    [|] 0.5|     [|]
# |   buffer  |     [|]
ransac_residual_threshold=35000  # more crops in a ridge, more values
ransac_max_trials=2000
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121010402-nbtkkmv" data-type="NodeParagraph" class="p" id="20220121010402-nbtkkmv" updated="20220121010408"><div contenteditable="false" spellcheck="false">For ridge detection:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220120223014-urpl3to" data-type="NodeList" class="list" id="20220120223014-urpl3to" updated="20220121010355"><div data-marker="*" data-subtype="u" data-node-id="20220121004511-8s6m4j3" data-type="NodeListItem" class="li" id="20220121004511-8s6m4j3" updated="20220121010355"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220121004511-wd2e5mx" data-type="NodeParagraph" class="p" id="20220121004511-wd2e5mx" updated="20220121005038"><div contenteditable="false" spellcheck="false"><code>edited_center_points_shapefile</code>: previous you renamed and edited shapefile</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220121005039-0udhmld" data-type="NodeListItem" class="li" id="20220121005039-0udhmld"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220121005039-x3tgjav" data-type="NodeParagraph" class="p" id="20220121005039-x3tgjav" updated="20220121005427"><div contenteditable="false" spellcheck="false"><code>ridge_strength_ratio</code>: default 10</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121005425-4s7g2eq" data-type="NodeParagraph" class="p" updated="20220121005506" id="20220121005425-4s7g2eq"><div contenteditable="false" spellcheck="false">calculate the x distribution counts by: x = round(points.x / 10) * 10</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121005500-js34e1z" data-type="NodeParagraph" class="p" id="20220121005500-js34e1z" updated="20220121005606"><div contenteditable="false" spellcheck="false">Higher value, the peaks will higher and more distinguishable</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121005332-ogcmp4r" data-type="NodeParagraph" class="p" id="20220121005332-ogcmp4r" updated="20220121005333"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220121005333-2935a71.png" data-src="assets/image-20220121005333-2935a71.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220121005749-j5hi1vq" data-type="NodeListItem" class="li" id="20220121005749-j5hi1vq"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220121005749-31mevxn" data-type="NodeParagraph" class="p" id="20220121005749-31mevxn" updated="20220121005843"><div contenteditable="false" spellcheck="false"><code>ridge_direction</code>: along x or along y axis</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121005902-zsizzxb" data-type="NodeParagraph" class="p" id="20220121005902-zsizzxb" updated="20220121005946"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 319px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220121005947-7dpj2xj.png" data-src="assets/image-20220121005947-7dpj2xj.png" alt="image.png" style="width: 309px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220121005950-8s0a6bw" data-type="NodeListItem" class="li" id="20220121005950-8s0a6bw"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220121005950-31wi502" data-type="NodeParagraph" class="p" id="20220121005950-31wi502" updated="20220121010107"><div contenteditable="false" spellcheck="false"><code>ridge_distance_parameters</code>: the minimum distance of each peak (red cross), higher value will result some peak missing</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121010045-9x4ym93" data-type="NodeParagraph" class="p" id="20220121010045-9x4ym93" updated="20220121010046"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220121005333-2935a71.png" data-src="assets/image-20220121005333-2935a71.png" alt="image.png" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220121010141-0lrkg21" data-type="NodeListItem" class="li" id="20220121010141-0lrkg21"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220121010141-72ctslb" data-type="NodeParagraph" class="p" id="20220121010141-72ctslb" updated="20220121010215"><div contenteditable="false" spellcheck="false"><code>ridge_height_parameters</code>: the green threshold to filter local peaks below this line</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121010341-1v3b8bs" data-type="NodeParagraph" class="p" id="20220121010341-1v3b8bs" updated="20220121010422"><div contenteditable="false" spellcheck="false">For regressing points to ridge line</div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="u" data-node-id="20220121010339-0mwsamd" data-type="NodeList" class="list" id="20220121010339-0mwsamd" updated="20220121214528"><div data-marker="*" data-subtype="u" data-node-id="20220121010251-xm8wag9" data-type="NodeListItem" class="li" updated="20220121214444" id="20220121010251-xm8wag9"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220121010251-pld2lg0" data-type="NodeParagraph" class="p" id="20220121010251-pld2lg0" updated="20220121010648"><div contenteditable="false" spellcheck="false"><code>ridge_buffer</code>: the ridge region to include points</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121010652-lhsvvcq" data-type="NodeParagraph" class="p" id="20220121010652-lhsvvcq" updated="20220121011039"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 549px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220121011039-5b597vf.png" data-src="assets/image-20220121011039-5b597vf.png" alt="image.png" style="width: 539px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121011045-4wn50ml" data-type="NodeParagraph" class="p" id="20220121011045-4wn50ml" updated="20220121214444"><div contenteditable="false" spellcheck="false">By default=0.5, is the middle line between two ridges.</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220121214225-l9bcixx" data-type="NodeListItem" class="li" id="20220121214225-l9bcixx" updated="20220121214528"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220121214225-a4i92qy" data-type="NodeParagraph" class="p" id="20220121214225-a4i92qy" updated="20220121214229"><div contenteditable="false" spellcheck="false"><code>use_ransac</code> = False</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121214232-gx9djsv" data-type="NodeParagraph" class="p" updated="20220121214446" id="20220121214232-gx9djsv"><div contenteditable="false" spellcheck="false">By default, assume the ridge and points are straight enough, the ridge attribution of each points can be simply divied by the middle line, no need to use RANSAC to regression</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121214432-lyoxiwv" data-type="NodeParagraph" class="p" id="20220121214432-lyoxiwv" updated="20220121214528"><div contenteditable="false" spellcheck="false">The ransac method can be used to remove some outlier noise points in some contents, but are not very recommened to use.</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220121011102-p2iwikl" data-type="NodeListItem" class="li" id="20220121011102-p2iwikl" updated="20220119231422"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220121011102-dwho1rh" data-type="NodeParagraph" class="p" id="20220121011102-dwho1rh" updated="20220121012303"><div contenteditable="false" spellcheck="false"><code>ransac_residual_threshold</code></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121012644-o0ya7to" data-type="NodeParagraph" class="p" id="20220121012644-o0ya7to" updated="20220121012739"><div contenteditable="false" spellcheck="false">A not correctly use but workable solution</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220119231340-dz95aqh" data-type="NodeParagraph" class="p" id="20220119231340-dz95aqh" updated="20220119231422"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 503px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220119231355-bu701wd.png" data-src="assets/image-20220119231355-bu701wd.png" alt="image.png" title="wrong, please increase redisudal thresh" style="width: 493px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title">wrong, please increase redisudal thresh</span></span><span> </span></span><span contenteditable="false" data-type="img" class="img" style="max-width: 501px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220119231422-b4aap8m.png" data-src="assets/image-20220119231422-b4aap8m.png" alt="image.png" title="correct example" style="width: 491px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title">correct example</span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-marker="*" data-subtype="u" data-node-id="20220121012705-z64g809" data-type="NodeListItem" class="li" id="20220121012705-z64g809"><div class="protyle-action" draggable="true"><svg><use xlink:href="#iconDot"></use></svg></div><div data-node-id="20220121012705-cr2i6yf" data-type="NodeParagraph" class="p" id="20220121012705-cr2i6yf" updated="20220121012726"><div contenteditable="false" spellcheck="false"><code>ransac_max_trials</code>: higher may make results more stable</div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121012729-thu82r9" data-type="NodeParagraph" class="p" id="20220121012729-thu82r9" updated="20220121014011"><div contenteditable="false" spellcheck="false">Don't worry too much about previous parameters, the scripts enables you to interactively adjust these parameters.</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014034-j5teu6v" data-type="NodeCodeBlock" class="code-block" updated="20220121014552" id="20220121014034-j5teu6v"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false"># please cd to the folder 11_root_pos first
(uavbroccoli) path/to/github/UAVbroccoli/11_root_pos&gt; python 06_order_by_ridge.py
[io][shp][fields] Shp fields: {'id': 0}
[io][shp][fields] Shp fields: {'name': 0}
[io][shp][name] Plot 11097 loaded | 11098/11098
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014011-03remr6" data-type="NodeParagraph" class="p" id="20220121014011-03remr6" updated="20220121014243"><div contenteditable="false" spellcheck="false">This will popup the following figure:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014243-2zf82yd" data-type="NodeParagraph" class="p" updated="20220121014305" id="20220121014243-2zf82yd"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 705px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220121014305-7rcj141.png" data-src="assets/image-20220121014305-7rcj141.png" alt="image.png" style="width: 695px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014310-vnu9y7r" data-type="NodeParagraph" class="p" id="20220121014310-vnu9y7r" updated="20220121014327"><div contenteditable="false" spellcheck="false">After close this figure, the script will ask you the following questions:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014327-ex3pkmg" data-type="NodeCodeBlock" class="code-block" id="20220121014327-ex3pkmg" updated="20220121014558"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">(uavbroccoli) path/to/github/UAVbroccoli/11_root_pos&gt;python 06_order_by_ridge.py
[io][shp][fields] Shp fields: {'id': 0}
[io][shp][fields] Shp fields: {'name': 0}
[io][shp][name] Plot 11097 loaded | 11098/11098
Is all the ridges are correct?[Y/N]
&gt;&gt;&gt;
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121012757-232szvl" data-type="NodeParagraph" class="p" id="20220121012757-232szvl" updated="20220121014821"><div contenteditable="false" spellcheck="false">if you want to change other parameters, type <kbd>N</kbd> and press <kbd>Enter</kbd></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014516-5204jlc" data-type="NodeCodeBlock" class="code-block" id="20220121014516-5204jlc" updated="20220121015108"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">Is all the ridges are correct?[Y/N]
&gt;&gt;&gt; n

Please type parameter NUMBER want adjust:
[1] Strength Ratio = 10
[2] ridge direction = x
[3] distance parameters = 3
[4] height parameters = 20
&gt;&gt;&gt;
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121010215-gdhg45n" data-type="NodeParagraph" class="p" id="20220121010215-gdhg45n" updated="20220121014641"><div contenteditable="false" spellcheck="false">Then type number 1-4, to change the parameter:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014709-qbgfqaf" data-type="NodeCodeBlock" class="code-block" id="20220121014709-qbgfqaf" updated="20220121214955"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">Please type parameter NUMBER want adjust:
[1] Strength Ratio = 10
[2] ridge direction = x
[3] distance parameters = 3
[4] height parameters = 20
&gt;&gt;&gt; 2
Change to?
&gt;&gt;&gt; y
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220120191538-3sdmrcr" data-type="NodeParagraph" class="p" id="20220120191538-3sdmrcr" updated="20220121015124"><div contenteditable="false" spellcheck="false">Then will change to the other ridge direction:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014731-gyj0d50" data-type="NodeParagraph" class="p" id="20220121014731-gyj0d50" updated="20220121014746"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 638px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220121014746-uorkqgi.png" data-src="assets/image-20220121014746-uorkqgi.png" alt="image.png" style="width: 628px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014800-mgb4tw3" data-type="NodeParagraph" class="p" id="20220121014800-mgb4tw3" updated="20220121014842"><div contenteditable="false" spellcheck="false">Adjust these parameters until you are satisfied with the ridge detection results, type <kbd>Y</kbd> and press <kbd>Enter</kbd>, go to next regressing points;</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014845-igx5x0y" data-type="NodeThematicBreak" class="hr" updated="20220121014845" id="20220121014845-igx5x0y"><div></div></div><div data-node-id="20220121214545-5wa58ar" data-type="NodeParagraph" class="p" id="20220121214545-5wa58ar" updated="20220121214558"><div contenteditable="false" spellcheck="false"><strong>Calculate the ridge attribution of each points</strong></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121214556-t96g71u" data-type="NodeParagraph" class="p" id="20220121214556-t96g71u" updated="20220121215212"><div contenteditable="false" spellcheck="false">The default ridge middle line could produce perfect results:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121215212-xe74jmi" data-type="NodeParagraph" class="p" updated="20220121215213" id="20220121215212-xe74jmi"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 770px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220121215214-wakuwu6.png" data-src="assets/image-20220121215214-wakuwu6.png" alt="image.png" style="width: 760px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121214556-9vfgi6b" data-type="NodeParagraph" class="p" id="20220121214556-9vfgi6b" updated="20220121215624"><div contenteditable="false" spellcheck="false">But you can also change it to RANSAC regression mode:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121215625-plupuoh" data-type="NodeCodeBlock" class="code-block" updated="20220121215810" id="20220121215625-plupuoh"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">bash</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">Is all the ridges colors are correct? 11098 of 11098 re-labeled, 0 ignored[Y/N]
&gt;&gt;&gt; n

Please type parameter NUMBER want adjust:
[1] Ridge buffer = 0.5
[2] Use RANSAC = False
[3] RANSAC residual threshold = 35
[4] RANSAC max trails = 2000
&gt;&gt;&gt; 2
Change to?
&gt;&gt;&gt; true
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121215755-29veu4e" data-type="NodeParagraph" class="p" id="20220121215755-29veu4e" updated="20220121215839"><div contenteditable="false" spellcheck="false">Then will get the results of RANSAC regression (but the start points are also splitted by ridge middle line)</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121014847-3xrhudi" data-type="NodeParagraph" class="p" id="20220121014847-3xrhudi" updated="20220121215749"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 769px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220121215749-ygzidq5.png" data-src="assets/image-20220121215749-ygzidq5.png" alt="image.png" style="width: 759px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121015351-h1x855a" data-type="NodeParagraph" class="p" id="20220121015351-h1x855a" updated="20220121215923"><div contenteditable="false" spellcheck="false">obviously, there are some points missing, increase the residual threshold or run it again may give different results</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121015544-82jt8b5" data-type="NodeCodeBlock" class="code-block" id="20220121015544-82jt8b5" updated="20220121215931"><div class="protyle-action protyle-icons"><span class="protyle-action__language" contenteditable="false">python</span><span class="protyle-action__copy"></span></div><div contenteditable="false" spellcheck="false">Is all the ridges colors are correct? 7980 of 11098 re-labeled, 3118 ignored[Y/N]
&gt;&gt;&gt; n

Please type parameter NUMBER want adjust:
[1] RANSAC residual threshold = 35
[2] RANSAC max trails = 2000
&gt;&gt;&gt; 1
Change to?
&gt;&gt;&gt; 35000
Is all the ridges colors are correct? 11097 of 11098 re-labeled, 1 ignored[Y/N]
&gt;&gt;&gt;
</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121015441-ymutvho" data-type="NodeParagraph" class="p" id="20220121015441-ymutvho" updated="20220121015540"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 771px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220121015541-dztjfbk.png" data-src="assets/image-20220121015541-dztjfbk.png" alt="image.png" style="width: 761px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121015614-8d3i572" data-type="NodeParagraph" class="p" id="20220121015614-8d3i572" updated="20220121220522"><div contenteditable="false" spellcheck="false">Still 1 points missing, the RANSAC method is used in previous version and not very recommended here</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121220527-g6sj974" data-type="NodeParagraph" class="p" id="20220121220527-g6sj974" updated="20220121220733"><div contenteditable="false" spellcheck="false">The final results will be save to <code>ordered_center_points.shp</code> file, and look like this:</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121220733-zu422bk" data-type="NodeParagraph" class="p" id="20220121220733-zu422bk" updated="20220121220734"><div contenteditable="false" spellcheck="false"><span contenteditable="false" data-type="img" class="img" style="max-width: 686px;"><span> </span><span><span class="protyle-action protyle-icons"><span><svg class="svg"><use xlink:href="#iconMore"></use></svg></span></span><img src="assets/image-20220120224834-b82ti64.png" data-src="assets/image-20220120224834-b82ti64.png" alt="image.png" style="width: 676px;" /><span class="protyle-action__drag"></span><span class="protyle-action__title"></span></span><span> </span></span></div><div class="protyle-attr" contenteditable="false"></div></div><div data-subtype="h1" data-node-id="20220121164847-j5nzjmy" data-type="NodeHeading" class="h1" id="20220121164847-j5nzjmy" updated="20220121220803"><div contenteditable="false" spellcheck="false">Step 4: Segment broccoli head</div><div class="protyle-attr" contenteditable="false"></div></div><div data-node-id="20220121220804-2bhk0sw" data-type="NodeParagraph" class="p" id="20220121220804-2bhk0sw" updated="20220121220808"><div contenteditable="false" spellcheck="false">To be continued</div><div class="protyle-attr" contenteditable="false"></div></div></div>
<script src="appearance/icons/notion-icon/icon.js?1.7.5"></script>
<script src="stage/build/export/protyle-method.js?1.7.5"></script>
<script src="stage/protyle/js/lute/lute.min.js?1.7.5"></script>    
<script>
    window.siyuan = {
      config: {
        appearance: { mode: 0, codeBlockThemeDark: "base16/dracula", codeBlockThemeLight: "github" },
        editor: { 
          codeSyntaxHighlightLineNum: true,
        }
      },
      languages: {copy:"复制"}
    };
    const previewElement = document.getElementById('preview');
    Protyle.codeRender(previewElement);
    Protyle.highlightRender(previewElement, "stage/protyle");
    Protyle.mathRender(previewElement, "stage/protyle", false);
    Protyle.mermaidRender(previewElement, "stage/protyle");
    Protyle.flowchartRender(previewElement, "stage/protyle");
    Protyle.graphvizRender(previewElement, "stage/protyle");
    Protyle.chartRender(previewElement, "stage/protyle");
    Protyle.mindmapRender(previewElement, "stage/protyle");
    Protyle.abcRender(previewElement, "stage/protyle");
    Protyle.plantumlRender(previewElement, "stage/protyle");
    Protyle.mediaRender(previewElement);
    document.querySelectorAll(".protyle-action__copy").forEach((item) => {
      item.addEventListener("click", (event) => {
            navigator.clipboard.writeText(item.parentElement.nextElementSibling.textContent.trimEnd());
            item.setAttribute("aria-label", "已复制");
            event.preventDefault();
            event.stopPropagation();
      })
    });
</script></body></html>